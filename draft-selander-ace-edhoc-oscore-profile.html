<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Ephemeral Diffie-Hellman Over COSE (EDHOC) and Object Security for Constrained Environments (OSCORE) Profile for Authentication and Authorization for Constrained Environments (ACE)</title>
<meta content="Göran Selander" name="author">
<meta content="John Preuß Mattsson" name="author">
<meta content="Marco Tiloca" name="author">
<meta content="Rikard Höglund" name="author">
<meta content="
       This document specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework.
It utilizes Ephemeral Diffie-Hellman Over COSE (EDHOC) for achieving mutual authentication between an OAuth 2.0 Client and Resource Server, and it binds an authentication credential of the Client to an OAuth 2.0 access token.
EDHOC also establishes an Object Security for Constrained RESTful Environments (OSCORE) Security Context, which is used to secure communications when accessing protected resources according to the authorization information indicated in the access token.
A resource-constrained server can use this profile to delegate management of authorization information to a trusted host with less severe limitations regarding processing power and memory. 
    " name="description">
<meta content="xml2rfc 3.12.10" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-selander-ace-edhoc-oscore-profile-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.10
    Python 3.10.4
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.1
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.8.0
    MarkupSafe 2.0.1
    pycountry 20.7.3
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.4.0
    six 1.16.0
-->
<link href="draft-selander-ace-edhoc-oscore-profile.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
dd.break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: 14.5px;
}
.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([stroke="fill"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">CoAP-EDHOC-OSCORE</td>
<td class="right">June 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Selander, et al.</td>
<td class="center">Expires 25 December 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">ACE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-selander-ace-edhoc-oscore-profile-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-06-23" class="published">23 June 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-12-25">25 December 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">G. Selander</div>
<div class="org">Ericsson</div>
</div>
<div class="author">
      <div class="author-name">J. Preuß Mattsson</div>
<div class="org">Ericsson</div>
</div>
<div class="author">
      <div class="author-name">M. Tiloca</div>
<div class="org">RISE</div>
</div>
<div class="author">
      <div class="author-name">R. Höglund</div>
<div class="org">RISE</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Ephemeral Diffie-Hellman Over COSE (EDHOC) and Object Security for Constrained Environments (OSCORE) Profile for Authentication and Authorization for Constrained Environments (ACE)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework.
It utilizes Ephemeral Diffie-Hellman Over COSE (EDHOC) for achieving mutual authentication between an OAuth 2.0 Client and Resource Server, and it binds an authentication credential of the Client to an OAuth 2.0 access token.
EDHOC also establishes an Object Security for Constrained RESTful Environments (OSCORE) Security Context, which is used to secure communications when accessing protected resources according to the authorization information indicated in the access token.
A resource-constrained server can use this profile to delegate management of authorization information to a trusted host with less severe limitations regarding processing power and memory.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Authentication and Authorization for Constrained Environments Working Group mailing list (ace@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/ace/">https://mailarchive.ietf.org/arch/browse/ace/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/EricssonResearch/ace-edhoc-oscore-profile">https://github.com/EricssonResearch/ace-edhoc-oscore-profile</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 25 December 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-protocol-overview" class="xref">Protocol Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-client-as-communication" class="xref">Client-AS Communication</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-c-to-as-post-to-token-endpo" class="xref">C-to-AS: POST to token endpoint</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-as-to-c-access-token-respon" class="xref">AS-to-C: Access Token Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-the-edhoc_information" class="xref">The EDHOC_Information</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-client-rs-communication" class="xref">Client-RS Communication</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-c-to-rs-post-to-authz-info-" class="xref">C-to-RS: POST to authz-info endpoint</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-rs-to-c-201-created" class="xref">RS-to-C: 2.01 (Created)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-edhoc-execution-and-setup-o" class="xref">EDHOC Execution and Setup of OSCORE Security Context</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-access-rights-verification" class="xref">Access Rights Verification</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-use-of-edhoc-keyupdate" class="xref">Use of EDHOC-KeyUpdate</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-secure-communication-with-t" class="xref">Secure Communication with the AS</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-discarding-the-security-con" class="xref">Discarding the Security Context</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-privacy-considerations" class="xref">Privacy Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-ace-oauth-profile-registry" class="xref">ACE OAuth Profile Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-oauth-parameters-registry" class="xref">OAuth Parameters Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="xref">10.3</a>.  <a href="#name-oauth-parameters-cbor-mappi" class="xref">OAuth Parameters CBOR Mappings Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4">
                <p id="section-toc.1-1.10.2.4.1"><a href="#section-10.4" class="xref">10.4</a>.  <a href="#name-json-web-token-claims-regis" class="xref">JSON Web Token Claims Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.5">
                <p id="section-toc.1-1.10.2.5.1"><a href="#section-10.5" class="xref">10.5</a>.  <a href="#name-cbor-web-token-claims-regis" class="xref">CBOR Web Token Claims Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.6">
                <p id="section-toc.1-1.10.2.6.1"><a href="#section-10.6" class="xref">10.6</a>.  <a href="#name-jwt-confirmation-methods-re" class="xref">JWT Confirmation Methods Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.7">
                <p id="section-toc.1-1.10.2.7.1"><a href="#section-10.7" class="xref">10.7</a>.  <a href="#name-cwt-confirmation-methods-re" class="xref">CWT Confirmation Methods Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.8">
                <p id="section-toc.1-1.10.2.8.1"><a href="#section-10.8" class="xref">10.8</a>.  <a href="#name-edhoc-external-authorizatio" class="xref">EDHOC External Authorization Data Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.9">
                <p id="section-toc.1-1.10.2.9.1"><a href="#section-10.9" class="xref">10.9</a>.  <a href="#name-edhoc-information-registry" class="xref">EDHOC Information Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.10">
                <p id="section-toc.1-1.10.2.10.1"><a href="#section-10.10" class="xref">10.10</a>. <a href="#name-expert-review-instructions" class="xref">Expert Review Instructions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-examples" class="xref">Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#appendix-A.1" class="xref">A.1</a>.  <a href="#name-workflow-without-optimizati" class="xref">Workflow without Optimizations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#appendix-A.2" class="xref">A.2</a>.  <a href="#name-workflow-with-optimizations" class="xref">Workflow with Optimizations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#appendix-A.3" class="xref">A.3</a>.  <a href="#name-workflow-without-optimizatio" class="xref">Workflow without Optimizations (AS token posting)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-B" class="xref"></a><a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-C" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document defines the "coap_edhoc_oscore" profile of the ACE framework <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. This profile addresses a "zero-touch" constrained setting where trusted operations can be performed with low overhead without endpoint specific configurations.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Like in the "coap_oscore" profile <span>[<a href="#I-D.ietf-ace-oscore-profile" class="xref">I-D.ietf-ace-oscore-profile</a>]</span>, also in this profile a client (C) and a resource server (RS) use the Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> to communicate, and Object Security for Constrained RESTful Environments (OSCORE) <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> to protect their communications. Besides, the processing of requests for specific protected resources is identical to what is defined in the "coap_oscore" profile.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">When using this profile, C accesses protected resources hosted at the RS with the use of an access token issued by a trusted authorization server (AS) and bound to an authentication credential of C. This differs from the "coap_oscore" profile, where the access token is bound to a symmetric key used to derive OSCORE keying material. As recommended in <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>, this document recommends the use of CBOR Web Tokens (CWTs) <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span> as access tokens.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">The authentication and authorization workflow requires C and the RS to have access to each other's authentication credentials. In particular, C obtains both an access token and an authentication credential of the RS from the AS, while the RS can obtain the access token for C (and the authentication credential of C included therin) through different possible options. If the RS successfully verifies the access token, then C and the RS run the Ephemeral Diffie-Hellman Over COSE (EDHOC) protocol <span>[<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>, with each peer using its own and the other peer's authentication credential.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">Once completed the EDHOC execution, C and the RS are mutually authenticated and establish an OSCORE Security Context to protect following communications, while the RS achieves proof of possession of the private key of C. Instead, C achieves proof of possession of the private key of the RS either once completed the EDHOC execution (if an optional, fourth EDHOC message is sent by the RS) or after the first message exchange using OSCORE.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">Authentication credentials can be a raw public key, e.g., encoded as a CWT Claims Set (CCS, <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span>); or a public key certificate, e.g., encoded as an X.509 certificate or as a CBOR encoded X.509 certificate (C509, <span>[<a href="#I-D.ietf-cose-cbor-encoded-cert" class="xref">I-D.ietf-cose-cbor-encoded-cert</a>]</span>); or a different type of data structure containing (or uniquely referring to) the public key of the peer in question.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">The ACE protocol establishes what those authentication credentials are, and may transport the actual authentication credentials by value or rather uniquely refer to them. If an actual authentication credential is pre-provisioned or can be obtained over less constrained links, then it suffices that ACE provides a unique reference such as a certificate hash (e.g., by using the COSE header parameter "x5t", see <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span>). This is in the same spirit as EDHOC, where the authentication credentials may be transported or referenced in the ID_CRED_x message fields (see Section 3.5.3 of <span>[<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>).<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">Generally, the AS and RS are likely to have trusted access to each other's authentication credentials, since the AS acts on behalf of the RS as per the trust model of ACE. Also, the AS needs to have some information about C, including the respective authentication credential, in order to identify C when it requests an access token and to determine what access rights it can be granted. However, the authentication credential of C may potentially be conveyed (or uniquely referred to) within the request sent to the AS.<a href="#section-1-8" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Certain security-related terms such as "authentication", "authorization", "confidentiality", "(data) integrity", "Message Authentication Code (MAC)", "Hash-based Message Authentication Code (HMAC)", and "verify" are taken from <span>[<a href="#RFC4949" class="xref">RFC4949</a>]</span>.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">RESTful terminology follows HTTP <span>[<a href="#RFC7231" class="xref">RFC7231</a>]</span>.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">Readers are expected to be familiar with the terms and concepts defined in CoAP <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>, OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> and EDHOC <span>[<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">Readers are also expected to be familiar with the terms and concepts of the ACE framework described in <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span> and in <span>[<a href="#I-D.ietf-ace-oauth-params" class="xref">I-D.ietf-ace-oauth-params</a>]</span>.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<p id="section-1.1-6">Terminology for entities in the architecture is defined in OAuth 2.0 <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>, such as client (C), resource server (RS), and authorization server (AS).  It is assumed in this document that a given resource on a specific RS is associated to a unique AS.<a href="#section-1.1-6" class="pilcrow">¶</a></p>
<p id="section-1.1-7">Note that the term "endpoint" is used here, as in <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>, following its OAuth definition, which is to denote resources such as token and introspect at the AS and authz-info at the RS. The CoAP <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> definition, which is "An entity participating in the CoAP protocol" is not used in this document.<a href="#section-1.1-7" class="pilcrow">¶</a></p>
<p id="section-1.1-8">The authorization information (authz-info) resource refers to the authorization information endpoint as specified in <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. The term "claim" is used in this document with the same semantics as in <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>, i.e., it denotes information carried in the access token or returned from introspection.<a href="#section-1.1-8" class="pilcrow">¶</a></p>
<p id="section-1.1-9">Furthermore, this document refers to the following term.<a href="#section-1.1-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-10.1">Token series - A series of access tokens sorted in chronological order of release and such that: they are all issued by the same AS; they are all issued to the same C and for the same RS; they are all issued together with the same authentication credential of the RS; and they are all bound to the same authentication credential of C used as proof-of-possession key. When an access token becomes invalid (e.g., due to its expiration or revocation), the token series it belongs to ends.<a href="#section-1.1-10.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.1-11">Concise Binary Object Representation (CBOR) <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span><span>[<a href="#RFC8742" class="xref">RFC8742</a>]</span> and Concise Data Definition Language (CDDL) <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span> are used in this document. CDDL predefined type names, especially bstr for CBOR byte strings and tstr for CBOR text strings, are used extensively in this document.<a href="#section-1.1-11" class="pilcrow">¶</a></p>
<p id="section-1.1-12">Examples throughout this document are expressed in CBOR diagnostic notation without the tag and value abbreviations.<a href="#section-1.1-12" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="overview">
<section id="section-2">
      <h2 id="name-protocol-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
      </h2>
<p id="section-2-1">This section gives an overview of how to use the ACE framework <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span> together with the authenticated key establishment protocol EDHOC <span>[<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>. By doing so, a client (C) and a resource server (RS) generate an OSCORE Security Context <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> associated with authorization information, and use that Security Context to protect their communications. The parameters needed by C to negotiate the use of this profile with the authorization server (AS), as well as the OSCORE setup process, are described in detail in the following sections.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The RS maintains a collection of authentication credentials. These are related to OSCORE Security Contexts associated with authorization information for all the clients that the RS is communicating with. The authorization information is maintained as policy that is used as input to the processing of requests from those clients.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">This profile requires C to retrieve an access token from the AS for the resources it wants to access on an RS, by sending an access token request to the token endpoint, as specified in Section 5.8 of <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. The access token request and response MUST be confidentiality protected and ensure authenticity. The use of EDHOC and OSCORE between C and the AS is RECOMMENDED in this profile, in order to reduce the number of libraries that C has to support. However, other protocols fulfilling the security requirements defined in Section 5 of <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span> MAY alternatively be used, such as TLS <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span> or DTLS <span>[<a href="#RFC9147" class="xref">RFC9147</a>]</span>.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">Once C has retrieved the access token, C uploads it to the RS. To this end, there are two different options, as further detailed in this document.<a href="#section-2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-5.1">C posts the access token to the authz-info endpoint by using the mechanisms specified in Section 5.8 of <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. If the access token is valid, the RS responds to the request with a 2.01 (Created) response, after which C initiates the EDHOC protocol by sending EDHOC message_1 to the RS. When using this profile, the communication with the authz-info endpoint is not protected, except for the update of access rights.<a href="#section-2-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-5.2">C initiates the EDHOC protocol by sending EDHOC message_1 to the RS, specifying the access token as External Authorization Data (EAD) in the EAD_1 field of EDHOC message_1 (see Section 3.8 <span>[<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>). If the access token is valid and the processing of EDHOC message_1 is successful, the RS responds with EDHOC message_2, thus continuing the EDHOC protocol. This alternative cannot be used for the update of access rights.<a href="#section-2-5.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-6">When running the EDHOC protocol, C uses the authentication credential of the RS specified by the AS together with the access token, while the RS uses the authentication credential of C bound to and specified within the access token. If C and the RS complete the EDHOC execution successfully, they are mutually authenticated and they derive an OSCORE Security Context as per <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>. Also, the RS associates the two used authentication credentials and the completed EDHOC execution with the derived Security Context. The latter is in turn associated with the access token and the access rights of C specified therein.<a href="#section-2-6" class="pilcrow">¶</a></p>
<p id="section-2-7">From then on, C effectively gains authorized and secure access to protected resources on the RS, for as long as the access token is valid. Until then, C can communicate with the RS by sending a request protected with the established OSCORE Security Context above. The Security Context is discarded when an access token (whether the same or a different one) is used to successfully derive a new Security Context for C, either by re-running EDHOC or by exchanging nonces and using the EDHOC-KeyUpdate function (see <a href="#edhoc-key-update" class="xref">Section 5</a>). In particular, when supporting this profile, both C and the RS MUST support the EDHOC-KeyUpdate function.<a href="#section-2-7" class="pilcrow">¶</a></p>
<p id="section-2-8">After the whole message exchange has taken place, C can contact the AS to request an update of its access rights, by sending a similar request to the token endpoint. This request also includes an identifier, which allows the AS to find the correct data it has previously shared with C. This specific identifier, encoded as a byte string, is assigned by the AS to a "token series" (see <a href="#terminology" class="xref">Section 1.1</a>). Upon a successful update of access rights, the new issued access token becomes the latest one of its token series. When the latest access token of a token series becomes invalid (e.g., when it expires or gets revoked), that token series ends.<a href="#section-2-8" class="pilcrow">¶</a></p>
<p id="section-2-9">An overview of the profile flow for the "coap_edhoc_oscore" profile is given in <a href="#protocol-overview" class="xref">Figure 1</a>. The names of messages coincide with those of <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span> when applicable.<a href="#section-2-9" class="pilcrow">¶</a></p>
<span id="name-protocol-overview-2"></span><div id="protocol-overview">
<figure id="figure-1">
        <div class="alignLeft art-text artwork" id="section-2-10.1">
<pre>
   C                            RS                       AS
   |                            |                         |
   | &lt;==== Mutual authentication and secure channel ====&gt; |
   |                            |                         |
   | ------- POST /token  ------------------------------&gt; |
   |                            |                         |
   | &lt;-------------------------------- Access Token ----- |
   |                               + Access Information   |
   |                            |                         |
   | ---- POST /authz-info ---&gt; |                         |
   |       (access_token)       |                         |
   |                            |                         |
   | &lt;----- 2.01 Created ------ |                         |
   |                            |                         |
   | &lt;========= EDHOC ========&gt; |                         |
   |  Mutual authentication     |                         |
   |  and derivation of an      |                         |
   |  OSCORE Security Context   |                         |
   |                            |                         |
   |                /Proof-of-possession and              |
   |                Security Context storage/             |
   |                            |                         |
   | ---- OSCORE Request -----&gt; |                         |
   |                            |                         |
   | &lt;--- OSCORE Response ----- |                         |
   |                            |                         |
/Proof-of-possession            |                         |
and Security Context            |                         |
storage (latest)/               |                         |
   |                            |                         |
   | ---- OSCORE Request -----&gt; |                         |
   |                            |                         |
   | &lt;--- OSCORE Response ----- |                         |
   |                            |                         |
   |           ...              |                         |

</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-protocol-overview-2" class="selfRef">Protocol Overview</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="c-as-comm">
<section id="section-3">
      <h2 id="name-client-as-communication">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-client-as-communication" class="section-name selfRef">Client-AS Communication</a>
      </h2>
<p id="section-3-1">The following subsections describe the details of the POST request and response to the token endpoint between C and the AS.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">In this exchange, the AS provides C with the access token, together with a set of parameters that enable C to run EDHOC with the RS. These especially include the authorization credential of the RS, namely AUTH_CRED_RS, as transported by value or uniquely referred to.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">The proof-of-possession key (PoP-key) bound to the access token and specified therein, as transported by value or uniquely referred to, MUST be the authentication credential of C, namely AUTH_CRED_C. This is provided by C to the AS in the POST request to the token endpoint, as transported by value or uniquely referred to, by means of the "req_cnf" parameter defined in <span>[<a href="#I-D.ietf-ace-oauth-params" class="xref">I-D.ietf-ace-oauth-params</a>]</span>.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">The request to the token endpoint and the corresponding response can include EDHOC_Information, which is a CBOR map object defined in <a href="#edhoc-parameters-object" class="xref">Section 3.3</a>. This object is transported in the "edhoc_info" parameter registered in <a href="#iana-oauth-params" class="xref">Section 10.2</a> and <a href="#iana-oauth-cbor-mappings" class="xref">Section 10.3</a>.<a href="#section-3-4" class="pilcrow">¶</a></p>
<div id="c-as">
<section id="section-3.1">
        <h3 id="name-c-to-as-post-to-token-endpo">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-c-to-as-post-to-token-endpo" class="section-name selfRef">C-to-AS: POST to token endpoint</a>
        </h3>
<p id="section-3.1-1">The client-to-AS request is specified in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.8.1" class="relref">Section 5.8.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">The client must send this POST request to the token endpoint over a secure channel that guarantees authentication, message integrity and confidentiality (see <a href="#secure-comm-as" class="xref">Section 6</a>).<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">An example of such a request is shown in <a href="#token-request" class="xref">Figure 2</a>. In this example, C specifies its own authentication credential by reference, as the hash of an X.509 certificate carried in the "x5t" field of the "req_cnf" parameter. In fact, it is expected that C can typically specify its own authentication credential by reference, since the AS is expected to obtain the actual authentication credential during an early client registration process or during a previous secure association establishment with C.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<span id="name-example-of-c-to-as-post-tok"></span><div id="token-request">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-3.1-4.1">
<pre>
   Header: POST (Code=0.02)
   Uri-Host: "as.example.com"
   Uri-Path: "token"
   Content-Format: "application/ace+cbor"
   Payload:
   {
     "audience" : "tempSensor4711",
     "scope" : "read",
     "req_cnf" : {
       "x5t" : h'822E4879F2A41B510C1F9B'
     }
   }
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-example-of-c-to-as-post-tok" class="selfRef">Example of C-to-AS POST /token request for an access token.</a>
          </figcaption></figure>
</div>
<p id="section-3.1-5">If C wants to update its access rights without changing an existing OSCORE Security Context, it MUST include EDHOC_Information in its POST request to the token endpoint. In turn, EDHOC_Information MUST include the "id" field, carrying a CBOR byte string containing the identifier of the token series to which the current, still valid access token shared with the RS belongs to. This POST request MUST omit the "req_cnf" parameter.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6">This identifier is assigned by the AS as discussed in <a href="#as-c" class="xref">Section 3.2</a>, and, together with other information such as audience (see Section 5.8.1 of <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>), can be used by the AS to determine the token series to which the new requested access token has to be added. Therefore, the identifier MUST identify the pair (AUTH_CRED_C, AUTH_CRED_RS) associated with a still valid access token previously issued for C and the RS by the AS.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
<p id="section-3.1-7">The AS MUST verify that the received value identifies a token series to which a still valid access token issued for C and the RS belongs to. If that is not the case, the Client-to-AS request MUST be declined with the error code "invalid_request" as defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.8.3" class="relref">Section 5.8.3</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.<a href="#section-3.1-7" class="pilcrow">¶</a></p>
<p id="section-3.1-8">An example of such a request is shown in <a href="#token-request-update" class="xref">Figure 3</a>.<a href="#section-3.1-8" class="pilcrow">¶</a></p>
<span id="name-example-of-c-to-as-post-toke"></span><div id="token-request-update">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-3.1-9.1">
<pre>
   Header: POST (Code=0.02)
   Uri-Host: "as.example.com"
   Uri-Path: "token"
   Content-Format: "application/ace+cbor"
   Payload:
   {
     "audience" : "tempSensor4711",
     "scope" : "write",
     "edhoc_info" : {
        "id" : h'01'
     }
   }
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-example-of-c-to-as-post-toke" class="selfRef">Example of C-to-AS POST /token request for updating access rights to an access token.</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="as-c">
<section id="section-3.2">
        <h3 id="name-as-to-c-access-token-respon">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-as-to-c-access-token-respon" class="section-name selfRef">AS-to-C: Access Token Response</a>
        </h3>
<p id="section-3.2-1">After verifying the POST request to the token endpoint and that C is authorized to obtain an access token corresponding to its access token request, the AS responds as defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.8.2" class="relref">Section 5.8.2</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. If the request from C was invalid, or not authorized, the AS returns an error response as described in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.8.3" class="relref">Section 5.8.3</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">The AS can signal that the use of EDHOC and OSCORE as per this profile is REQUIRED for a specific access token, by including the "ace_profile" parameter with the value "coap_edhoc_oscore" in the access token response. This means that C MUST use EDHOC with the RS and derive an OSCORE Security Context, as specified in <a href="#edhoc-exec" class="xref">Section 4.3</a>. After that, C MUST use the established OSCORE Security Context to protect communications with the RS, when accessing protected resources at the RS according to the authorization information indicated in the access token. Usually, it is assumed that constrained devices will be pre-configured with the necessary profile, so that this kind of profile signaling can be omitted.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">When issuing any access token of a token series, the AS MUST send the following data in the response to C.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-4.1">
            <p id="section-3.2-4.1.1">The identifier of the token series to which the issued access token belongs to. This is specified in the "id" field of EDHOC_Information.<a href="#section-3.2-4.1.1" class="pilcrow">¶</a></p>
<p id="section-3.2-4.1.2">
All the access tokens belonging to the same token series are associated with the same identifier, which does not change throughout the series lifetime. A token series terminates when the latest issued access token in the series becomes invalid (e.g., when it expires or gets revoked).<a href="#section-3.2-4.1.2" class="pilcrow">¶</a></p>
<p id="section-3.2-4.1.3">
The AS assigns an identifier to a token series when issuing the first access token T of that series. When assigning the identifier, the AS MUST ensure that this was never used in a previous series of access tokens such that: i) they were issued for the same RS for which the access token T is being issued; and ii) they were bound to the same authentication credential AUTH_CRED_C of the requesting client to which the access token T is being issued (irrespectively of the exact way AUTH_CRED_C is specified in such access tokens).<a href="#section-3.2-4.1.3" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.2-5">When issuing the first access token of a token series, the AS MUST send the following data in the response to C.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-6.1">
            <p id="section-3.2-6.1.1">The authentication credential of the RS, namely AUTH_CRED_RS. This is specified in the "rs_cnf" parameter defined in <span>[<a href="#I-D.ietf-ace-oauth-params" class="xref">I-D.ietf-ace-oauth-params</a>]</span>. AUTH_CRED_RS can be transported by value or referred to by means of an appropriate identifier.<a href="#section-3.2-6.1.1" class="pilcrow">¶</a></p>
<p id="section-3.2-6.1.2">
When issuing the first access token ever to a pair (C, RS) using a pair of corresponding authentication credentials (AUTH_CRED_C, AUTH_CRED_RS), it is typically expected that the response to C specifies AUTH_CRED_RS by value.<a href="#section-3.2-6.1.2" class="pilcrow">¶</a></p>
<p id="section-3.2-6.1.3">
When later issuing further access tokens to the same pair (C, RS) using the same AUTH_CRED_RS, it is typically expected that the response to C specifies AUTH_CRED_RS by reference.<a href="#section-3.2-6.1.3" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.2-7">When issuing the first access token of a token series, the AS MAY send the following data in the response to C. If present, these data MUST be included in the corresponding fields of EDHOC_Information. Some of this information takes advantage of the knowledge that the AS may have about C and the RS since their early registration process, with particular reference to what they support as EDHOC peers.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-8.1">The EDHOC methods supported by both C and the RS (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>). This is specified in the "methods" field of EDHOC_Information.<a href="#section-3.2-8.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-8.2">The EDHOC cipher suite (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-3.6" class="relref">Section 3.6</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>) to be used by C and the RS as selected cipher suite when running EDHOC. This is specified in the "cipher_suites" field of EDHOC_Information. If present, this MUST specify the EDHOC cipher suite which is most preferred by C and at the same time supported by both C and the RS.<a href="#section-3.2-8.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-8.3">Whether the RS supports or not EDHOC message_4 (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-5.5" class="relref">Section 5.5</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>). This is specified in the "message_4" field of EDHOC_Information.<a href="#section-3.2-8.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-8.4">Whether the RS supports or not the combined EDHOC + OSCORE request defined in <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="xref">I-D.ietf-core-oscore-edhoc</a>]</span>. This is specified in the "comb_req" field of EDHOC_Information.<a href="#section-3.2-8.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-8.5">The path component of the URI of the EDHOC resource at the RS, where C is expected to send EDHOC messages as CoAP requests. This is specified in the "uri_path" field of EDHOC_Information. If not specified, the URI path "/.well-known/edhoc" defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-9.7" class="relref">Section 9.7</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>) is assumed.<a href="#section-3.2-8.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-8.6">The size in bytes of the OSCORE Master Secret to derive after the EDHOC execution (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>) and to use for establishing an OSCORE Security Context. This is specified in the "osc_ms_len" field of EDHOC_Information. If not specified, the default value from <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span> is assumed.<a href="#section-3.2-8.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-8.7">The size in bytes of the OSCORE Master Salt to derive after the EDHOC execution (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>) and to use for establishing an OSCORE Security Context. This is specified in the "osc_salt_len" field of EDHOC_Information. If not specified, the default value from <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span> is assumed.<a href="#section-3.2-8.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-8.8">The OSCORE version to use (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">Section 5.4</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>). This is specified in the "osc_version" field of EDHOC_Information. If specified, the AS MUST indicate the highest OSCORE version supported by both C and the RS. If not specified, the default value of 1 (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">Section 5.4</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>) is assumed.<a href="#section-3.2-8.8" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-9">When issuing any access token of a token series, the AS MUST specify the following data in the claims associated with the access token.<a href="#section-3.2-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-10.1">The identifier of the token series, specified in the "id" field of EDHOC_Information, and with the same value specified in the response to C from the token endpoint.<a href="#section-3.2-10.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-10.2">
            <p id="section-3.2-10.2.1">The same authentication credential of C that C specified in its POST request to the token endpoint (see <a href="#c-as" class="xref">Section 3.1</a>), namely AUTH_CRED_C. If the access token is a CWT, this information MUST be specified in the "cnf" claim.<a href="#section-3.2-10.2.1" class="pilcrow">¶</a></p>
<p id="section-3.2-10.2.2">
In the access token, AUTH_CRED_C can be transported by value or referred to by means of an appropriate identifier, regardless of how C specified it in the request to the token endpoint. Thus, the specific field carried in the access token claim and specifying AUTH_CRED_C depends on the specific way used by the AS.<a href="#section-3.2-10.2.2" class="pilcrow">¶</a></p>
<p id="section-3.2-10.2.3">
When issuing the first access token ever to a pair (C, RS) using a pair of corresponding authentication credentials (AUTH_CRED_C, AUTH_CRED_RS), it is typically expected that AUTH_CRED_C is specified by value.<a href="#section-3.2-10.2.3" class="pilcrow">¶</a></p>
<p id="section-3.2-10.2.4">
When later issuing further access tokens to the same pair (C, RS) using the same AUTH_CRED_C, it is typically expected that AUTH_CRED_C is specified by reference.<a href="#section-3.2-10.2.4" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.2-11">When issuing the first access token of a token series, the AS MAY specify the following data in the claims associated with the access token. If these data are specified in the response to C from the token endpoint, they MUST be included in the access token and specify the same values that they have in the response from the token endpoint.<a href="#section-3.2-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-12.1">The size in bytes of the OSCORE Master Secret to derive after the EDHOC execution and to use for establishing an OSCORE Security Context. If it is included, it is specified in the "osc_ms_len" field of EDHOC_Information, and it has the same value that the "osc_ms_len" field has in the response to C. If it is not included, the default value from <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span> is assumed.<a href="#section-3.2-12.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-12.2">The size in bytes of the OSCORE Master Salt to derive after the EDHOC execution (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>) and to use for establishing an OSCORE Security Context. If it is included, it is specified in the "osc_salt_len" field of EDHOC_Information, and it has the same value that the "osc_salt_len" field has in the response to C. If it is not included, the default value from <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span> is assumed.<a href="#section-3.2-12.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-12.3">The OSCORE version to use (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">Section 5.4</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>). This is specified in the "osc_version" field of the "edhoc_info" parameter. If it is included, it is specified in the "osc_version" field of EDHOC_Information, and it has the same value that the "osc_version" field has in the response to C. If it is not included, the default value of 1 (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">Section 5.4</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>) is assumed.<a href="#section-3.2-12.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-13">When issuing the first access token of a token series, the AS can take either of the two possible options.<a href="#section-3.2-13" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-14.1">The AS provides the access token to C, by specifying it in the "access_token" parameter of the access token response. In such a case, the access token response MAY include the parameter "access_token", which MUST encode the CBOR simple value "false" (0xf4).<a href="#section-3.2-14.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-14.2">
            <p id="section-3.2-14.2.1">The AS does not provide the access token to C. Rather, the AS uploads the access token to the authz-info endpoint at the RS, exactly like C would do, and as defined in <a href="#c-rs" class="xref">Section 4.1</a> and <a href="#rs-c" class="xref">Section 4.2</a>. Then, when replying to C with the access token response as defined above, the response MUST NOT include the parameter "access_token", and MUST include the parameter "token_uploaded" encoding the CBOR simple value "true" (0xf5). This is shown by the example in <a href="#example-without-optimization-as-posting" class="xref">Appendix A.3</a>.<a href="#section-3.2-14.2.1" class="pilcrow">¶</a></p>
<p id="section-3.2-14.2.2">
Note that, in case C and the RS have already completed an EDHOC execution leveraging a previous access token series, using this approach implies that C and the RS have to re-run the EDHOC protocol. That is, they cannot more efficiently make use of the EDHOC-KeyUpdate function, as defined in <a href="#edhoc-key-update" class="xref">Section 5</a>.<a href="#section-3.2-14.2.2" class="pilcrow">¶</a></p>
<p id="section-3.2-14.2.3">
Also note that this approach is not applicable when issuing access tokens following the first one in the same token series, i.e., when updating access rights.<a href="#section-3.2-14.2.3" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.2-15">When CWTs are used as access tokens, EDHOC_Information MUST be transported in the "edhoc_info" claim, defined in <a href="#iana-token-cwt-claims" class="xref">Section 10.5</a>.<a href="#section-3.2-15" class="pilcrow">¶</a></p>
<p id="section-3.2-16">Since the access token does not contain secret information, only its integrity and source authentication are strictly necessary to ensure. Therefore, the AS can protect the access token with either of the means discussed in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-6.1" class="relref">Section 6.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. Nevertheless, when using this profile, it is RECOMMENDED that the access token is a CBOR web token (CWT) protected with COSE_Encrypt/COSE_Encrypt0 as specified in <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span>.<a href="#section-3.2-16" class="pilcrow">¶</a></p>
<p id="section-3.2-17"><a href="#fig-token-response" class="xref">Figure 4</a> shows an example of an AS response. The "rs_cnf" parameter specifies the authentication credential of the RS, as an X.509 certificate tranported by value in the "x5chain" field. The access token and the authentication credential of the RS have been truncated for readability.<a href="#section-3.2-17" class="pilcrow">¶</a></p>
<span id="name-example-of-as-to-c-access-t"></span><div id="fig-token-response">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-3.2-18.1">
<pre>
   Header: Created (Code=2.01)
      Content-Type: "application/ace+cbor"
      Payload:
      {
        "access_token" : h'8343a1010aa2044c53 ...
         (remainder of access token (CWT) omitted for brevity)',
        "ace_profile" : "coap_edhoc_oscore",
        "expires_in" : "3600",
        "rs_cnf" : {
          "x5chain" : h'3081ee3081a1a00302 ...'
          (remainder of the access credential omitted for brevity)'
        }
        "edhoc_info" : {
          "id" : h'01',
          "methods" : [0, 1, 2, 3],
          "cipher_suites": 0
        }
      }
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-example-of-as-to-c-access-t" class="selfRef">Example of AS-to-C Access Token response with EDHOC and OSCORE profile.</a>
          </figcaption></figure>
</div>
<p id="section-3.2-19"><a href="#fig-token" class="xref">Figure 5</a> shows an example CWT Claims Set, including the relevant EDHOC parameters in the "edhoc_info" claim. The "cnf" claim specifies the authentication credential of C, as an X.509 certificate tranported by value in the "x5chain" field. The authentication credential of C has been truncated for readability.<a href="#section-3.2-19" class="pilcrow">¶</a></p>
<span id="name-example-of-cwt-claims-set-w"></span><div id="fig-token">
<figure id="figure-5">
          <div class="alignLeft art-text artwork" id="section-3.2-20.1">
<pre>
   {
    "aud" : "tempSensorInLivingRoom",
    "iat" : "1360189224",
    "exp" : "1360289224",
    "scope" :  "temperature_g firmware_p",
    "cnf" : {
      "x5chain" : h'3081ee3081a1a00302 ...'
    }
    "edhoc_info" : {
      "id" : h'01',
      "methods" : [0, 1, 2, 3],
      "cipher_suites": 0
    }
  }
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-example-of-cwt-claims-set-w" class="selfRef">Example of CWT Claims Set with EDHOC parameters.</a>
          </figcaption></figure>
</div>
<p id="section-3.2-21">If C has requested an update to its access rights using the same OSCORE Security Context, which is valid and authorized, then:<a href="#section-3.2-21" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-22.1">The response MUST NOT include the "rs_cnf" parameter.<a href="#section-3.2-22.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-22.2">The EDHOC_Information in the response MUST include only the "id" field, specifying the identifier of the token series.<a href="#section-3.2-22.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-22.3">The EDHOC_Information in the access token MUST include only the "id" field, specifying the identifier of the token series. In particular, if the access token is a CWT, the "edhoc_info" claim MUST include only the "id" field.<a href="#section-3.2-22.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-23">This identifier of the token series needs to be included in the new access token in order for the RS to identify the old access token to supersede, as well as the OSCORE Security Context already shared between C and the RS and to be associated with the new access token.<a href="#section-3.2-23" class="pilcrow">¶</a></p>
</section>
</div>
<div id="edhoc-parameters-object">
<section id="section-3.3">
        <h3 id="name-the-edhoc_information">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-the-edhoc_information" class="section-name selfRef">The EDHOC_Information</a>
        </h3>
<p id="section-3.3-1">An EDHOC_Information is an object including information that guides two peers towards executing the EDHOC protocol. In particular, the EDHOC_Information is defined to be serialized and transported between nodes, as specified by this document, but it can also be used by other specifications if needed.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">The EDHOC_Information can either be encoded as a JSON object or as a CBOR map.  The set of common fields that can appear in an EDHOC_Information can be found in the IANA "EDHOC Information" registry (see <a href="#iana-edhoc-parameters" class="xref">Section 10.9</a>), defined for extensibility, and the initial set of parameters defined in this document is specified below. All parameters are optional.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3"><a href="#fig-cbor-key-edhoc-params" class="xref">Figure 6</a> provides a summary of the EDHOC_Information parameters defined in this section.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
<span id="name-edhoc_information-parameter"></span><div id="fig-cbor-key-edhoc-params">
<figure id="figure-6">
          <div class="alignCenter art-text artwork" id="section-3.3-4.1">
<pre>
+---------------+------+--------------+----------+--------------------+
| Name          | CBOR | CBOR value   | Registry | Description        |
|               | Type |              |          |                    |
+---------------+------+--------------+----------+--------------------+
| id            | 0    | bstr         |          | Identifier of      |
|               |      |              |          | EDHOC execution    |
+---------------+------+--------------+----------+--------------------+
| methods       | 1    | int /        | EDHOC    | Set of supported   |
|               |      | array of int | Method   | EDHOC methods      |
|               |      |              | Type     |                    |
|               |      |              | Registry |                    |
+---------------+------+--------------+----------+--------------------+
| cipher_suites | 2    | int /        | EDHOC    | Set of supported   |
|               |      | array of int | Cipher   | EDHOC cipher       |
|               |      |              | Suites   | suites             |
|               |      |              | Registry |                    |
+---------------+------+--------------+----------+--------------------+
| key_update    | 3    | simple value |          | Support for the    |
|               |      | "true" /     |          | EDHOC-KeyUpdate    |
|               |      | simple value |          | function           |
|               |      | "false"      |          |                    |
+---------------+------+--------------+----------+--------------------+
| message_4     | 4    | simple value |          | Support for EDHOC  |
|               |      | "true" /     |          | message_4          |
|               |      | simple value |          |                    |
|               |      | "false"      |          |                    |
+---------------+------+--------------+----------+--------------------+
| comb_req      | 5    | simple value |          | Support for the    |
|               |      | "true" /     |          | EDHOC + OSCORE     |
|               |      | simple value |          | combined request   |
|               |      | "false"      |          |                    |
+---------------+------+--------------+----------+--------------------+
| uri_path      | 6    | tstr         |          | URI-path of the    |
|               |      |              |          | EDHOC resource     |
+---------------+------+--------------+----------+--------------------+
| osc_ms_len    | 7    | uint         |          | Length in bytes of |
|               |      |              |          | the OSCORE Master  |
|               |      |              |          | Secret to derive   |
+---------------+------+--------------+----------+--------------------+
| osc_salt_len  | 8    | uint         |          | Length in bytes of |
|               |      |              |          | the OSCORE Master  |
|               |      |              |          | Salt to derive     |
+---------------+------+--------------+----------+--------------------+
| osc_version   | 9    | uint         |          | OSCORE version     |
|               |      |              |          | number to use      |
+---------------+------+--------------+----------+--------------------+
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-edhoc_information-parameter" class="selfRef">EDHOC_Information Parameters</a>
          </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-3.3-5.1">id: This parameter identifies an EDHOC execution and is encoded as a byte string. In JSON, the "id" value is a Base64 encoded byte string. In CBOR, the "id" type is a byte string, and has label 0.<a href="#section-3.3-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.3-5.2">methods: This parameter specifies a set of supported EDHOC methods (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>). If the set is composed of a single EDHOC method, this is encoded as an integer. Otherwise, the set is encoded as an array of integers, where each array element encodes one EDHOC method. In JSON, the "methods" value is an integer or an array of integers. In CBOR, the "methods" is an integer or an array of integers, and has label 1.<a href="#section-3.3-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.3-5.3">cipher_suites: This parameter specifies a set of supported EDHOC cipher suites (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-3.6" class="relref">Section 3.6</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>). If the set is composed of a single EDHOC cipher suite, this is encoded as an integer. Otherwise, the set is encoded as an array of integers, where each array element encodes one EDHOC cipher suite. In JSON, the "cipher_suites" value is an integer or an array of integers. In CBOR, the "cipher_suites" is an integer or an array of integers, and has label 2.<a href="#section-3.3-5.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.3-5.4">key_update: This parameter indicates whether the EDHOC-KeyUpdate function (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-4.2.2" class="relref">Section 4.2.2</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>) is supported. In JSON, the "key_update" value is a boolean. In CBOR, "key_update" is the simple value "true" or "false", and has label 3.<a href="#section-3.3-5.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.3-5.5">message_4: This parameter indicates whether the EDHOC message_4 (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-5.5" class="relref">Section 5.5</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>) is supported. In JSON, the "message_4" value is a boolean. In CBOR, "message_4" is the simple value "true" or "false", and has label 4.<a href="#section-3.3-5.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.3-5.6">comb_req: This parameter indicates whether the combined EDHOC + OSCORE request defined in <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="xref">I-D.ietf-core-oscore-edhoc</a>]</span>) is supported. In JSON, the "comb_req" value is a boolean. In CBOR, "comb_req" is the simple value "true" or "false", and has label 5.<a href="#section-3.3-5.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.3-5.7">uri_path: This parameter specifies the path component of the URI of the EDHOC resource where EDHOC messages have to be sent as requests. In JSON, the "uri_path" value is a string. In CBOR, "uri_path" is text string, and has label 6.<a href="#section-3.3-5.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.3-5.8">osc_ms_len: This parameter specifies the size in bytes of the OSCORE Master Secret to derive after the EDHOC execution, as per <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>. In JSON, the "osc_ms_len" value is an integer. In CBOR, the "osc_ms_len" type is unsigned integer, and has label 7.<a href="#section-3.3-5.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.3-5.9">osc_salt_len: This parameter specifies the size in bytes of the OSCORE Master Salt to derive after the EDHOC execution, as per <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>. In JSON, the "osc_salt_len" value is an integer. In CBOR, the "osc_salt_len" type is unsigned integer, and has label 8.<a href="#section-3.3-5.9" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.3-5.10">osc_version: This parameter specifies the OSCORE Version number that the two EDHOC peers have to use when using OSCORE. For more information about this parameter, see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-5.4" class="relref">Section 5.4</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>. In JSON, the "osc_version" value is an integer. In CBOR, the "osc_version" type is unsigned integer, and has label 9.<a href="#section-3.3-5.10" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.3-6">An example of JSON EDHOC_Information is given in <a href="#fig-edhoc-info-json" class="xref">Figure 7</a>.<a href="#section-3.3-6" class="pilcrow">¶</a></p>
<span id="name-example-of-json-edhoc_infor"></span><div id="fig-edhoc-info-json">
<figure id="figure-7">
          <div class="alignLeft art-text artwork" id="section-3.3-7.1">
<pre>
   "edhoc_info" : {
       "id" : b64'AQ==',
       "methods" : 1,
       "cipher_suites" : 0
   }
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-example-of-json-edhoc_infor" class="selfRef">Example of JSON EDHOC\_Information</a>
          </figcaption></figure>
</div>
<p id="section-3.3-8">The CDDL grammar describing the CBOR EDHOC_Information is:<a href="#section-3.3-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.3-9">
<pre>
EDHOC_Information = {
   ? 0 =&gt; bstr,             ; id
   ? 1 =&gt; int / array,      ; methods
   ? 2 =&gt; int / array,      ; cipher_suites
   ? 3 =&gt; true / false,     ; key_update
   ? 4 =&gt; true / false,     ; message_4
   ? 5 =&gt; true / false,     ; comb_req
   ? 6 =&gt; tstr,             ; uri_path
   ? 7 =&gt; uint,             ; osc_ms_len
   ? 8 =&gt; uint,             ; osc_salt_len
   ? 9 =&gt; uint,             ; osc_version
   * int / tstr =&gt; any
}
</pre><a href="#section-3.3-9" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="c-rs-comm">
<section id="section-4">
      <h2 id="name-client-rs-communication">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-client-rs-communication" class="section-name selfRef">Client-RS Communication</a>
      </h2>
<p id="section-4-1">The following subsections describe the exchanges between C and the RS, which comprise the token uploading to the RS, and the execution of the EDHOC protocol. Note that, as defined in <a href="#as-c" class="xref">Section 3.2</a>, the AS may not have provided C with the access token, and have rather uploaded the access token to the authz-info endpoint at the RS on behalf of C.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">In order to upload the access token to the RS, C can send a POST request to the authz-info endpoint at the RS. This is detailed in <a href="#c-rs" class="xref">Section 4.1</a> and <a href="#rs-c" class="xref">Section 4.2</a>, and it is shown by the example in <a href="#example-without-optimization" class="xref">Appendix A.1</a>.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">Alternatively, C can upload the access token while executing the EDHOC protocol, by transporting the access token in the EAD_1 field of the first EDHOC message sent to the RS. This is further discussed in <a href="#edhoc-exec" class="xref">Section 4.3</a>, and it is shown by the example in <a href="#example-with-optimization" class="xref">Appendix A.2</a>.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">In either case, following the uploading of the access token, C and the RS run the EDHOC protocol to completion, by exchanging POST requests and related responses to a dedicated EDHOC resource at the RS (see <a href="#edhoc-exec" class="xref">Section 4.3</a>). Once completed the EDHOC execution, C and the RS have agreed on a common secret key PRK_OUT (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-4.1.3" class="relref">Section 4.1.3</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>), from which they establish an OSCORE Security Context (see <a href="#edhoc-exec" class="xref">Section 4.3</a>). After that, C and the RS use the established OSCORE Security Context to protect their communications when accessing protected resources at the RS, as per the access rights specified in the access token (see <a href="#access-rights-verif" class="xref">Section 4.4</a>).<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">Note that, by means of the respective authentication credentials, C and the RS are mutually authenticated once they have successfully completed the execution of the EDHOC protocol.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">As to proof-of-possession, the RS always gains knowledge that C has PRK_OUT at the end of the successful EDHOC execution. Instead, C gains knowledge that the RS has PRK_OUT either when receiving and successfully verifying the optional EDHOC message_4 from the RS, or when successully verifying a response from the RS protected with the generated OSCORE Security Context.<a href="#section-4-6" class="pilcrow">¶</a></p>
<div id="c-rs">
<section id="section-4.1">
        <h3 id="name-c-to-rs-post-to-authz-info-">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-c-to-rs-post-to-authz-info-" class="section-name selfRef">C-to-RS: POST to authz-info endpoint</a>
        </h3>
<p id="section-4.1-1">The access token can be uploaded to the RS by using the authz-info endpoint at the RS. To this end, C MUST use CoAP <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> and the Authorization Information endpoint described in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.10.1" class="relref">Section 5.10.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span> in order to transport the access token.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">That is, C sends a POST request to the authz-info endpoint at the RS, with the request payload conveying the access token without any CBOR wrapping. As per <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.10.1" class="relref">Section 5.10.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>, the Content-Format of the POST request has to reflect the format of the transported access token. In particular, if the access token is a CWT, the content-format MUST be "application/cwt".<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">The communication with the authz-info endpoint does not have to be protected, except for the update of access rights case described below.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">Note that C may be required to re-POST the access token in order to complete an access request to a protected resource, since the RS may delete a stored access token (and associated OSCORE Security Context) at any time, for example due to all storage space being consumed. This situation is detected by C when it receives an AS Request Creation Hints response from the RS (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.3" class="relref">Section 5.3</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>). After reposting the same access token, C and the RS run the EDHOC protocol again, or instead rely on the more efficient method leveraging the EDHOC-KeyUpdate function (see <a href="#edhoc-key-update" class="xref">Section 5</a>). In either case, C and the RS will derive a new OSCORE Security Context to be used for protecting their communications from then on.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">Also, C may want to update the OSCORE Security Context currently shared with the RS. To this end, C can rely on either of the following options.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-6.1">Re-POST the access token, after which C and the RS run the EDHOC protocol again, or instead rely on the more efficient method leveraging the EDHOC-KeyUpdate function (see <a href="#edhoc-key-update" class="xref">Section 5</a>). After that, C and the RS derive a new OSCORE Security Context.<a href="#section-4.1-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-6.2">Run the OSCORE key update protocol KUDOS defined in <span>[<a href="#I-D.ietf-core-oscore-key-update" class="xref">I-D.ietf-core-oscore-key-update</a>]</span>, if it is supported by both C and the RS. A successful execution of KUDOS also yields a new OSCORE Security Context. However, running the KUDOS protocol is lighter than relying on the previous approach, especially since it does not require to re-post the current access token.<a href="#section-4.1-6.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.1-7">In either case, C and the RS have established a new OSCORE Security Context that replaces the current one and will be used for protecting their communications from then on. In particular, the RS MUST associate the new OSCORE Security Context with the current (just re-posted) access token. Note that, unless C and the RS re-run the EDHOC protocol, they preserve their same OSCORE identifiers, i.e., their OSCORE Sender/Recipient IDs.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1-8">If C has already posted a valid access token, has already established an OSCORE Security Context with the RS, and wants to update its access rights, then C can do so by posting a new access token to the /authz-info endpoint, as described above. The new access token contains the updated access rights for C to access protected resources at the RS, and C has to obtain it from the AS as a new access token in the same token series of the current one (see <a href="#c-as" class="xref">Section 3.1</a> and <a href="#as-c" class="xref">Section 3.2</a>). When posting the new access token to the authz-info endpoint, C MUST protect the POST request using the current OSCORE Security Context shared with the RS. After successful verification (see <a href="#rs-c" class="xref">Section 4.2</a>), the RS will replace the old access token with the new one, while preserving the same OSCORE Security Context. In particular, C and the RS do not re-run the EDHOC protocol and they do not establish a new OSCORE Security Context.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rs-c">
<section id="section-4.2">
        <h3 id="name-rs-to-c-201-created">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-rs-to-c-201-created" class="section-name selfRef">RS-to-C: 2.01 (Created)</a>
        </h3>
<p id="section-4.2-1">Upon receiving an access token from C, the RS MUST follow the procedures defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.10.1" class="relref">Section 5.10.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. That is, the RS must verify the validity of the access token. The RS may make an introspection request (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.9.1" class="relref">Section 5.9.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>) to validate the access token.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">If the access token is valid, the RS proceeds as follows.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">The RS checks whether it is already storing the authentication credential of C, namely AUTH_CRED_C, specified as PoP-key in the access token by value or reference. In such a case, the RS stores the access token and MUST reply to the POST request with a 2.01 (Created) response.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">Otherwise, the RS retrieves AUTH_CRED_C, e.g., from the access token if the authentication credential is specified therein by value, or from a further trusted source pointed to by the AUTH_CRED_C identifier included in the access token. After that, the RS validates the actual AUTH_CRED_C. In case of successful validation, the RS stores AUTH_CRED_C as a valid authentication credential. Then, the RS stores the access token and MUST reply to the POST request with a 2.01 (Created) response.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2-5">If the RS does not find an already stored AUTH_CRED_C, or fails to retrieve it or to validate it, then the RS MUST respond with an error response code equivalent to the CoAP code 4.00 (Bad Request). The RS may provide additional information in the payload of the error response, in order to clarify what went wrong.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<p id="section-4.2-6">Instead, if the access token is valid but it is associated with claims that the RS cannot process (e.g., an unknown scope), or if any of the expected parameters is missing (e.g., any of the mandatory parameters from the AS or the identifier "id"), or if any parameters received in the EDHOC_Information is unrecognized, then the RS MUST respond with an error response code equivalent to the CoAP code 4.00 (Bad Request). In the latter two cases, the RS may provide additional information in the payload of the error response, in order to clarify what went wrong.<a href="#section-4.2-6" class="pilcrow">¶</a></p>
<p id="section-4.2-7">When an access token becomes invalid (e.g., due to its expiration or revocation), the RS MUST delete the access token and the associated OSCORE Security Context, and MUST notify C with an error response with code 4.01 (Unauthorized) for any long running request, as specified in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.8.3" class="relref">Section 5.8.3</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.<a href="#section-4.2-7" class="pilcrow">¶</a></p>
<p id="section-4.2-8">If the RS receives an access token in an OSCORE protected request, it means that C is requesting an update of access rights. In such a case, the RS MUST check that both the following conditions hold.<a href="#section-4.2-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-9.1">The RS checks whether it stores an access token T_OLD, such that the "id" field of EDHOC_Identifier matches the "id" field of EDHOC_Identifier in the new access token T_NEW.<a href="#section-4.2-9.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-9.2">The RS checks whether the OSCORE Security Context CTX used to protect the request matches the OSCORE Security Context associated with the stored access token T_OLD.<a href="#section-4.2-9.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-10">If both the conditions above hold, the RS MUST replace the old access token T_OLD with the new access token T_NEW, and associate T_NEW with the OSCORE Security Context CTX. Then, the RS MUST respond with a 2.01 (Created) response protected with the same OSCORE Security Context, with no payload.<a href="#section-4.2-10" class="pilcrow">¶</a></p>
<p id="section-4.2-11">Otherwise, the RS MUST respond with a 4.01 (Unauthorized) error response. The RS may provide additional information in the payload of the error response, in order to clarify what went wrong.<a href="#section-4.2-11" class="pilcrow">¶</a></p>
<p id="section-4.2-12">As specified in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.10.1" class="relref">Section 5.10.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>, when receiving an updated access token with updated authorization information from C (see <a href="#c-rs" class="xref">Section 4.1</a>), it is recommended that the RS overwrites the previous access token. That is, only the latest authorization information in the access token received by the RS is valid. This simplifies the process needed by the RS to keep track of authorization information for a given client.<a href="#section-4.2-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="edhoc-exec">
<section id="section-4.3">
        <h3 id="name-edhoc-execution-and-setup-o">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-edhoc-execution-and-setup-o" class="section-name selfRef">EDHOC Execution and Setup of OSCORE Security Context</a>
        </h3>
<p id="section-4.3-1">In order to mutually authenticate and establish a long-term secret key PRK_OUT with forward secrecy, C and the RS run the EDHOC protocol <span>[<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>. In particular, C acts as EDHOC Initiator thus sending EDHOC message_1, while the RS acts as EDHOC Responder.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">As per <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.2" class="relref">Appendix A.2</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>, C sends EDHOC message_1 and EDHOC message_3 to an EDHOC resource at the RS, as CoAP POST requests. Also the RS sends EDHOC message_2 and (optionally) EDHOC message_4 as 2.04 (Changed) CoAP responses. If, in the access token response received from the AS (see <a href="#c-as" class="xref">Section 3.1</a>), the "uri_path" field of the EDHOC_Information was included, then C MUST target the EDHOC resource at the RS with the URI path specified in the "uri_path" field.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">In order to seamlessly run EDHOC, clients do not have to first upload to the RS an access token whose scope explicitly indicates authorized access to the EDHOC resource. At the same time, the RS has to ensure that attackers cannot perform requests on the EDHOC resource, other than sending EDHOC messages. Specifically, it SHOULD NOT be possible to perform anything else than POST on an EDHOC resource.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">When preparing EDHOC message_1, C performs the following steps, in additions to those defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-5.2.1" class="relref">Section 5.2.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-5.1">If, in the access token response received from the AS (see <a href="#c-as" class="xref">Section 3.1</a>), the "methods" field of the EDHOC_Information was included, then C MUST specify one of those EDHOC methods in the METHOD field of EDHOC message_1. That is, one of the EDHOC methods specified in the "methods" field of EDHOC_Information MUST be the EDHOC method used when running EDHOC with the RS.<a href="#section-4.3-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-5.2">If, in the access token response received from the AS (see <a href="#c-as" class="xref">Section 3.1</a>), the "cipher_suites" field of the EDHOC_Information was included, then C MUST specify the EDHOC cipher suite therein in the SUITES_I field of EDHOC message_1. That is, the EDHOC cipher suite specified in the "cipher_suites" field of EDHOC_Information MUST be the selected cipher suite when running EDHOC with the RS.<a href="#section-4.3-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-5.3">
            <p id="section-4.3-5.3.1">Rather than first uploading the access token to the authz-info endpoint at the RS as described in <a href="#c-rs" class="xref">Section 4.1</a>, C MAY include the access token in the EAD_1 field of EDHOC message_1 (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-3.8" class="relref">Section 3.8</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>). This is shown by the example in <a href="#example-with-optimization" class="xref">Appendix A.2</a>.<a href="#section-4.3-5.3.1" class="pilcrow">¶</a></p>
<p id="section-4.3-5.3.2">
In such a case, as per <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-3.8" class="relref">Section 3.8</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>, C adds the pair EAD_ACCESS_TOKEN = (ead_label, ead_value) to the EAD_1 field. In particular, ead_label is the integer value TBD registered in <a href="#iana-edhoc-ead" class="xref">Section 10.8</a> of this document, while ead_value is a CBOR byte string with value the access token. That is, the value of the CBOR byte string is the content of the "access_token" field of the access token response from the AS (see <a href="#as-c" class="xref">Section 3.2</a>).<a href="#section-4.3-5.3.2" class="pilcrow">¶</a></p>
<p id="section-4.3-5.3.3">
If EDHOC message_1 includes the pair EAD_ACCESS_TOKEN within the field EAD_1, then the RS MUST process the access token carried out in ead_value as specified in <a href="#rs-c" class="xref">Section 4.2</a>. If such a process fails, the RS MUST reply to C as specified in <a href="#rs-c" class="xref">Section 4.2</a>, it MUST discontinue the EDHOC protocol, and it MUST NOT send an EDHOC error message (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-6" class="relref">Section 6</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>). The RS MUST have successfully completed the processing of the access token before continuing the EDHOC execution by sending EDHOC message_2.<a href="#section-4.3-5.3.3" class="pilcrow">¶</a></p>
<p id="section-4.3-5.3.4">
Note that the EAD_1 field of EDHOC message_1 cannot carry an access token for the update of access rights, but rather only an access token issued as the first of a token series.<a href="#section-4.3-5.3.4" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.3-6">In EDHOC message_2, the authentication credential CRED_R indicated by the message field ID_CRED_R is the authentication credential of the RS, namely AUTH_CRED_RS, that C obtained from the AS. The processing of EDHOC message_2 is defined in detail in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-5.3" class="relref">Section 5.3</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
<p id="section-4.3-7">In EDHOC message_3, the authentication credential CRED_I indicated by the message field ID_CRED_I is the authentication credential of C, namely AUTH_CRED_C, i.e., the PoP key bound to the access token and specified therein. The processing of EDHOC message_3 is defined in detail in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-5.4" class="relref">Section 5.4</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>.<a href="#section-4.3-7" class="pilcrow">¶</a></p>
<p id="section-4.3-8">Once successfully completed the EDHOC execution, C and the RS have both derived the long-term secret key PRK_OUT (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-4.1.3" class="relref">Section 4.1.3</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>), from which they both derive the key PRK_Exporter (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-4.2.1" class="relref">Section 4.2.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>). Then, C and the RS derive an OSCORE Security Context, as defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>. In addition, the following applies.<a href="#section-4.3-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-9.1">If, in the access token response received from the AS (see <a href="#c-as" class="xref">Section 3.1</a>) and in the access token, the "osc_ms_size" field of the EDHOC_Information was included, then C and the RS MUST use the value specified in the "osc_ms_size" field as length in bytes of the OSCORE Master Secret. That is, the value of the "osc_ms_size" field MUST be used as value for the oscore_key_length parameter of the EDHOC-Exporter function when deriving the OSCORE Master Secret (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>).<a href="#section-4.3-9.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-9.2">If, in the access token response received from the AS (see <a href="#c-as" class="xref">Section 3.1</a>) and in the access token, the "osc_salt_size" field of the EDHOC_Information was included, then C and the RS MUST use the value specified in the "osc_salt_size" field as length in bytes of the OSCORE Master Salt. That is, the value of the "osc_salt_size" field MUST be used as value for the oscore_salt_length parameter of the EDHOC-Exporter function when deriving the OSCORE Master Salt (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#appendix-A.1" class="relref">Appendix A.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>).<a href="#section-4.3-9.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-9.3">If, in the access token response received from the AS (see <a href="#c-as" class="xref">Section 3.1</a>) and in the access token, the "osc_version" field of the EDHOC_Information was included, then C and the RS MUST derive the OSCORE Security Context, and later use it to protect their communications, consistently with the OSCORE version specified in the "osc_version" field.<a href="#section-4.3-9.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-9.4">Given AUTH_CRED_C the authentication credential of C used as CRED_I in the completed EDHOC execution, the RS associates the derived OSCORE Security Context with the stored access token bound to AUTH_CRED_C as PoP-key (regardless of whether AUTH_CRED_C is specified by value or by reference in the access token claims).<a href="#section-4.3-9.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.3-10">If C supports it, C MAY use the EDHOC + OSCORE combined request defined in <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="xref">I-D.ietf-core-oscore-edhoc</a>]</span>, as also shown by the example in <a href="#example-with-optimization" class="xref">Appendix A.2</a>. In such a case, both EDHOC message_3 and the first OSCORE-protected application request to a protected resource are sent to the RS as combined together in a single OSCORE-protected CoAP request, thus saving one round trip. This requires C to derive the OSCORE Security Context with RS already after having successfully processed the received EDHOC message_2. If, in the access token response received from the AS (see <a href="#c-as" class="xref">Section 3.1</a>), the "comb_req" field of the EDHOC_Information was included and specified the CBOR simple value "false" (0xf4), then C MUST NOT use the EDHOC + OSCORE combined request with the RS.<a href="#section-4.3-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="access-rights-verif">
<section id="section-4.4">
        <h3 id="name-access-rights-verification">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-access-rights-verification" class="section-name selfRef">Access Rights Verification</a>
        </h3>
<p id="section-4.4-1">The RS MUST follow the procedures defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.10.2" class="relref">Section 5.10.2</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. That is, if the RS receives an OSCORE-protected request targeting a protected resource from C, then the RS processes the request according to <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>, when Version 1 of OSCORE is used. Future specifications may define new versions of OSCORE, that the AS can indicate C and the RS to use by means of the "osc_version" field of EDHOC_Information (see <a href="#c-as-comm" class="xref">Section 3</a>).<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">If OSCORE verification succeeds and the target resource requires authorization, the RS retrieves the authorization information using the access token associated with the OSCORE Security Context. Then, the RS must verify that the authorization information covers the target resource and the action intended by C on it.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="edhoc-key-update">
<section id="section-5">
      <h2 id="name-use-of-edhoc-keyupdate">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-use-of-edhoc-keyupdate" class="section-name selfRef">Use of EDHOC-KeyUpdate</a>
      </h2>
<p id="section-5-1">Once successully completed an EDHOC execution, C and the RS are expected to preserve the EDHOC state of such an execution, as long as the authentication credentials of both C and the RS, namely AUTH_CRED_C and AUTH_CRED_RS are valid. This especially consists in preserving the secret key PRK_OUT attained at the end of the EDHOC execution.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Then, in case C has to establish a new OSCORE Security Context with the RS, they may not re-run the EDHOC protocol, but rather more efficiently rely on the EDHOC-KeyUpdate function, defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-4.2.2" class="relref">Section 4.2.2</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>. When supporting this profile, both C and the RS MUST support the EDHOC-KeyUpdate function.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">Establishing a new OSCORE Security Context by levaraging the EDHOC-KeyUpdate function is possible in the following cases.<a href="#section-5-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-4.1">C has to upload to the RS the newly obtained, first access token of a new token series, as an unprotected POST request to the authz-info endpoint at the RS. This is the case after the latest access token of the previous token series has become invalid (e.g., it expired or got revoked), and thus the RS has deleted it together with the associated OSCORE Security Context (see <a href="#discard-context" class="xref">Section 7</a>).<a href="#section-5-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-4.2">C re-uploads to the RS the current access token shared with the RS, i.e., the latest access token in the current token series, as an unprotected POST request to the authz-info endpoint at the RS. Like in <a href="#c-rs" class="xref">Section 4.1</a>, this is the case when C simply wants to replace the current OSCORE Security Context with a new one, and associate it with the same current, re-uploaded access token.<a href="#section-5-4.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-5">In either case, C and the RS have to establish a new OSCORE Security Context and to associate it with the (re-)uploaded access token.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">When using this approach, C and the RS perform the following actions.<a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7">C MUST generate a nonce value N1 vary unlikely to have been used with the same pair of authentication credentials (AUTH_CRED_C, AUTH_CRED_RS). When using this profile, it is RECOMMENDED to use a 64-bit long random number as the nonce's value. C MUST store the nonce N1 as long as the response from the RS is not received and the access token related to it is still valid (to the best of C's knowledge).<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8">C MUST use CoAP <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> and the Authorization Information resource as described in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.10.1" class="relref">Section 5.10.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span> to transport the access token and N1 to the RS.<a href="#section-5-8" class="pilcrow">¶</a></p>
<p id="section-5-9">Note that, unlike what is defined in <a href="#c-rs" class="xref">Section 4.1</a>, the use of the payload and of the Content-Format is different from what is described in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.10.1" class="relref">Section 5.10.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>, where only the access token is transported and without any CBOR wrapping. That is, C MUST wrap the access token and N1 in a CBOR map, and MUST use the Content-Format "application/ace+cbor" defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-8.16" class="relref">Section 8.16</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. The CBOR map MUST specify the access token using the "access_token" parameter, and N1 using the "nonce1" parameter defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oscore-profile-19#section-4.1.1" class="relref">Section 4.1.1</a> of [<a href="#I-D.ietf-ace-oscore-profile" class="xref">I-D.ietf-ace-oscore-profile</a>]</span>.<a href="#section-5-9" class="pilcrow">¶</a></p>
<p id="section-5-10">The communication with the authz-info endpoint at the RS MUST NOT be protected. This approach is not applicable when C uploads to the RS for the first time an access token to update access rights (which rather requires protected communication and does not result in deriving a new OSCORE Security Context).<a href="#section-5-10" class="pilcrow">¶</a></p>
<p id="section-5-11"><a href="#fig-post-edhoc-key-update" class="xref">Figure 8</a> shows an example of the POST request sent by C to the RS. The access token has been truncated for readability.<a href="#section-5-11" class="pilcrow">¶</a></p>
<span id="name-example-of-c-to-rs-post-aut"></span><div id="fig-post-edhoc-key-update">
<figure id="figure-8">
        <div class="alignLeft art-text artwork" id="section-5-12.1">
<pre>
   Header: POST (Code=0.02)
   Uri-Host: "rs.example.com"
   Uri-Path: "authz-info"
   Content-Format: "application/ace+cbor"
   Payload:
     {
       "access_token": h'8343a1010aa2044c53 ...
        (remainder of access token (CWT) omitted for brevity)',
       "nonce1": h'018a278f7faab55a'
     }
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-example-of-c-to-rs-post-aut" class="selfRef">Example of C-to-RS POST /authz-info request using CWT and EDHOC-KeyUpdate</a>
        </figcaption></figure>
</div>
<p id="section-5-13">Upon receiving the POST request from C, the RS MUST follow the procedures defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.10.1" class="relref">Section 5.10.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. That is, the RS must verify the validity of the access token. The RS may make an introspection request (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.9.1" class="relref">Section 5.9.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>) to validate the access token.<a href="#section-5-13" class="pilcrow">¶</a></p>
<p id="section-5-14">If the access token is valid, the RS proceeds as follows.<a href="#section-5-14" class="pilcrow">¶</a></p>
<p id="section-5-15">The RS checks whether it is already storing the authentication credential of C, namely AUTH_CRED_C, specified as PoP-key in the access token by value or reference.<a href="#section-5-15" class="pilcrow">¶</a></p>
<p id="section-5-16">If the RS does not find AUTH_CRED_C among the stored authentication credentials, the RS retrieves AUTH_CRED_C, e.g., from the access token if the authentication credential is specified therein by value, or from a further trusted source pointed to by the AUTH_CRED_C identifier included in the access token. After that, the RS validates the actual AUTH_CRED_C. In case of successful validation, the RS stores AUTH_CRED_C as a valid authentication credential.<a href="#section-5-16" class="pilcrow">¶</a></p>
<p id="section-5-17">If the RS does not find an already stored AUTH_CRED_C, or fails to retrieve it or to validate it, then the RS MUST respond with an error response code equivalent to the CoAP code 4.00 (Bad Request). The RS may provide additional information in the payload of the error response, in order to clarify what went wrong.<a href="#section-5-17" class="pilcrow">¶</a></p>
<p id="section-5-18">If the access token is valid but it is associated with claims that the RS cannot process (e.g., an unknown scope), or if any of the expected parameters is missing (e.g., any of the mandatory parameters from the AS or the identifier "id"), or if any parameters received in the EDHOC_Information is unrecognized, then the RS MUST respond with an error response code equivalent to the CoAP code 4.00 (Bad Request). In the latter two cases, the RS may provide additional information in the payload of the error response, in order to clarify what went wrong.<a href="#section-5-18" class="pilcrow">¶</a></p>
<p id="section-5-19">If the RS does not find the stored state of a completed EDHOC execution where the authentication credential AUTH_CRED_C was used as CRED_I, then the RS MUST respond with an error response code equivalent to the CoAP code 4.00 (Bad Request). The RS may provide additional information in the payload of the error response, in order to clarify what went wrong.<a href="#section-5-19" class="pilcrow">¶</a></p>
<p id="section-5-20">Otherwise, if all the steps above are successful, the RS stores the access token and MUST generate a nonce N2 very unlikely to have been previously used with the same pair of authentication credentials (AUTH_CRED_C, AUTH_CRED_RS). When using this profile, it is RECOMMENDED to use a 64-bit long random number as the nonce's value. Then, the RS MUST reply to the POST request with a 2.01 (Created) response, for which the RS MUST use the Content-Format "application/ace+cbor" defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-8.14" class="relref">Section 8.14</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. The payload of the response MUST be a CBOR map, which MUST specify N2 using the "nonce2" parameter defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oscore-profile-19#section-4.2.1" class="relref">Section 4.2.1</a> of [<a href="#I-D.ietf-ace-oscore-profile" class="xref">I-D.ietf-ace-oscore-profile</a>]</span>.<a href="#section-5-20" class="pilcrow">¶</a></p>
<p id="section-5-21"><a href="#fig-rs-c-edhoc-key-update" class="xref">Figure 9</a> shows an example of the response sent by the RS to C.<a href="#section-5-21" class="pilcrow">¶</a></p>
<span id="name-example-of-rs-to-c-201-crea"></span><div id="fig-rs-c-edhoc-key-update">
<figure id="figure-9">
        <div class="alignLeft art-text artwork" id="section-5-22.1">
<pre>
   Header: Created (Code=2.01)
   Content-Format: "application/ace+cbor"
   Payload:
     {
       "nonce2": h'25a8991cd700ac01'
     }
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-example-of-rs-to-c-201-crea" class="selfRef">Example of RS-to-C 2.01 (Created) response using EDHOC-KeyUpdate</a>
        </figcaption></figure>
</div>
<p id="section-5-23">Once they have exchanged N1 and N2, both C and the RS build a CBOR byte string EXTENDED_NONCE as follows.<a href="#section-5-23" class="pilcrow">¶</a></p>
<p id="section-5-24">First, RAW_STRING is prepared as the concatenation of N1 and N2, in this order: RAW_STRING = N1 | N2, where | denotes byte string concatenation, and N1 and N2 are the two nonces encoded as CBOR byte strings. Then, the resulting RAW_STRING is wrapped into the CBOR byte string EXTENDED_NONCE.<a href="#section-5-24" class="pilcrow">¶</a></p>
<p id="section-5-25">An example is given in <a href="#fig-edhoc-key-update-string" class="xref">Figure 10</a>, with reference to the values of N1 and N2 shown in <a href="#fig-post-edhoc-key-update" class="xref">Figure 8</a> and <a href="#fig-rs-c-edhoc-key-update" class="xref">Figure 9</a>.<a href="#section-5-25" class="pilcrow">¶</a></p>
<span id="name-example-of-extended_nonce-c"></span><div id="fig-edhoc-key-update-string">
<figure id="figure-10">
        <div class="alignLeft art-text artwork" id="section-5-26.1">
<pre>
   N1 and N2 expressed in CBOR diagnostic notation
   N1 = h'018a278f7faab55a'
   N2 = h'25a8991cd700ac01'

   N1 and N2 as CBOR encoded byte strings
   N1 = 0x48018a278f7faab55a
   N2 = 0x4825a8991cd700ac01

   RAW_STRING = 0x48 018a278f7faab55a 48 25a8991cd700ac01

   EXTENDED_NONCE expressed in CBOR diagnostic notation
   EXTENDED_NONCE = h'48018a278f7faab55a4825a8991cd700ac01'

   EXTENDED_NONCE as CBOR encoded byte string
   EXTENDED_NONCE = 0x52 48018a278f7faab55a4825a8991cd700ac01
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-example-of-extended_nonce-c" class="selfRef">Example of EXTENDED_NONCE construction, with N1 and N2 encoded in CBOR</a>
        </figcaption></figure>
</div>
<p id="section-5-27">If JSON is used instead of CBOR, then RAW_STRING is the Base64 encoding of the concatenation of the same parameters, each of them prefixed by their size encoded in 1 byte. When using JSON, the nonces have a maximum size of 255 bytes. An example is given in <a href="#fig-edhoc-key-update-string-json" class="xref">Figure 11</a>, where the nonces and RAW_STRING are encoded in Base64.<a href="#section-5-27" class="pilcrow">¶</a></p>
<span id="name-example-of-extended_nonce-co"></span><div id="fig-edhoc-key-update-string-json">
<figure id="figure-11">
        <div class="alignLeft art-text artwork" id="section-5-28.1">
<pre>
   N1 and N2 values
   N1 = 0x018a278f7faab55a (8 bytes)
   N2 = 0x25a8991cd700ac01 (8 bytes)

   Input to Base64 encoding:
   0x08 018a278f7faab55a 08 25a8991cd700ac01

   RAW_STRING = b64'CAGKJ49/qrVaCCWomRzXAKwB'

   EXTENDED_NONCE expressed in CBOR diagnostic notation
   EXTENDED_NONCE = h'08018a278f7faab55a0825a8991cd700ac01'

   EXTENDED_NONCE as CBOR encoded byte string
   EXTENDED_NONCE = 0x52 08018a278f7faab55a0825a8991cd700ac01
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-example-of-extended_nonce-co" class="selfRef">Example of EXTENDED_NONCE construction, with N1 and N2 encoded in JSON</a>
        </figcaption></figure>
</div>
<p id="section-5-29">Once computed the CBOR byte string CBOR_STRING, both C and the RS perform the following steps.<a href="#section-5-29" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-30">
<li id="section-5-30.1">C and the RS refer to the stored state of a completed EDHOC execution where the authentication credential AUTH_CRED_C was used as CRED_I. In case of multiple matches, the state of the latest completed EDHOC execution is considered.<a href="#section-5-30.1" class="pilcrow">¶</a>
</li>
        <li id="section-5-30.2">With reference to the EDHOC state determined at the previous step, C and the RS invoke the EDHOC-KeyUpdate function (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-4.2.2" class="relref">Section 4.2.2</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>), specifying the CBOR byte string EXTENDED_NONCE as "context" argument. This results in updating the secret key PRK_OUT to be considered from here on for this EDHOC state.<a href="#section-5-30.2" class="pilcrow">¶</a>
</li>
        <li id="section-5-30.3">With reference to the same EDHOC state as above, C and the RS update the secret key PRK_Exporter as per <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-4.2.1" class="relref">Section 4.2.1</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>. In particular, the key PRK_OUT derived at step 3 is specified as "PRK_out" argument. This results in updating the secret key PRK_Exporter to be considered from here on for this EDHOC state.<a href="#section-5-30.3" class="pilcrow">¶</a>
</li>
        <li id="section-5-30.4">C and the RS establish a new OSCORE Security Context as defined in <a href="#edhoc-exec" class="xref">Section 4.3</a>, just like if they had completed an EDHOC execution. Note that, since C and the RS have not re-run the EDHOC protocol, they preserve their same OSCORE identifiers, i.e., their OSCORE Sender/Recipient IDs.<a href="#section-5-30.4" class="pilcrow">¶</a>
</li>
        <li id="section-5-30.5">The RS associates the posted access token with the OSCORE Security Context established at step 5. In case C has in fact re-posted a still valid access token, the RS also discards the old OSCORE Security Context previously associated with that access token.<a href="#section-5-30.5" class="pilcrow">¶</a>
</li>
        <li id="section-5-30.6">Hereafter, C and the RS use the OSCORE Security Context established at step 5 to protect their communications.<a href="#section-5-30.6" class="pilcrow">¶</a>
</li>
      </ol>
</section>
</div>
<div id="secure-comm-as">
<section id="section-6">
      <h2 id="name-secure-communication-with-t">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-secure-communication-with-t" class="section-name selfRef">Secure Communication with the AS</a>
      </h2>
<p id="section-6-1">As specified in the ACE framework (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.9" class="relref">Section 5.9</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>), the requesting entity (RS and/or C) and the AS communicates via the introspection or token endpoint. When using this profile, the use of CoAP <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> and OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> for this communication is RECOMMENDED. Other protocols fulfilling the security requirements defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5" class="relref">Section 5</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span> (such as HTTP and DTLS or TLS) MAY be used instead.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">If OSCORE is used, the requesting entity and the AS need to have a OSCORE Security Context in place. While this can be pre-installed, the requesting entity and the AS can establish such an OSCORE Security Context, for example, by running the EDHOC protocol, as shown between C and the AS by the examples in <a href="#example-without-optimization" class="xref">Appendix A.1</a>, <a href="#example-with-optimization" class="xref">Appendix A.2</a> and <a href="#example-without-optimization-as-posting" class="xref">Appendix A.3</a>. The requesting entity and the AS communicate through the introspection endpoint as specified in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.9" class="relref">Section 5.9</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span> and through the token endpoint as specified in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.8" class="relref">Section 5.8</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">Furthermore, as defined in <a href="#as-c" class="xref">Section 3.2</a> and shown by the example in <a href="#example-without-optimization-as-posting" class="xref">Appendix A.3</a>, the AS may upload the access token to the authz-info endpoint at the RS, on behalf of C. In such a case, that exchange between the AS and the RS is not protected, just like when C uploads the access token to the RS by itself.<a href="#section-6-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="discard-context">
<section id="section-7">
      <h2 id="name-discarding-the-security-con">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-discarding-the-security-con" class="section-name selfRef">Discarding the Security Context</a>
      </h2>
<p id="section-7-1">There are a number of cases where C or the RS have to discard the OSCORE Security Context, and possibly establish a new one.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">C MUST discard the current OSCORE Security Context shared with the RS when any of the following occurs.<a href="#section-7-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-3.1">The OSCORE Sender Sequence Number space of C gets exhausted.<a href="#section-7-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-3.2">The access token associated with the OSCORE Security Context becomes invalid, for example due to expiration or revocation.<a href="#section-7-3.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-3.3">C receives a number of 4.01 (Unauthorized) responses to OSCORE-protected requests sent to the RS and protected using the same OSCORE Security Context. The exact number of such received responses needs to be specified by the application.<a href="#section-7-3.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-3.4">C receives a nonce N2 in the 2.01 (Created) response to an unprotected POST request to the authz-info endpoint at the RS, when re-posting a still valid access token associated to the existing OSCORE Security context together with a nonce N1, in order to trigger the use of the EDHOC-KeyUpdate function (see <a href="#edhoc-key-update" class="xref">Section 5</a>).<a href="#section-7-3.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-3.5">The authentication credential of C (of the RS) becomes invalid (e.g., due to expiration or revocation), and it was used as CRED_I (CRED_R) in the EDHOC execution whose PRK_OUT was used to establish the OSCORE Security Context.<a href="#section-7-3.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-7-4">The RS MUST discard the current OSCORE Security Context shared with C when any of the following occurs:<a href="#section-7-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-5.1">The OSCORE Sender Sequence Number space of the RS gets exhausted.<a href="#section-7-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-5.2">The access token associated with the OSCORE Security Context becomes invalid, for example due to expiration or revocation.<a href="#section-7-5.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-5.3">The current OSCORE Security Context shared with C has been successfully replaced  with a newer one, following an unprotected POST request to the authz-info endpoint at the RS that re-posted a still valid access token together with a nonce N1, in order to trigger the use of the EDHOC-KeyUpdate function (see <a href="#edhoc-key-update" class="xref">Section 5</a>).<a href="#section-7-5.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-5.4">The authentication credential of C (of the RS) becomes invalid (e.g., due to expiration or revocation), and it was used as CRED_I (CRED_R) in the EDHOC execution whose PRK_OUT was used to establish the OSCORE Security Context.<a href="#section-7-5.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-7-6">After a new access token is successfully uploaded to the RS, and a new OSCORE Security Context is established between C and the RS, messages still in transit that were protected with the previous OSCORE Security Context might not be successfully verified by the recipient, since the old OSCORE Security Context might have been discarded. This means that messages sent shortly before C has uploaded the new access token to the RS might not be successfully accepted by the recipient.<a href="#section-7-6" class="pilcrow">¶</a></p>
<p id="section-7-7">Furthermore, implementations may want to cancel CoAP observations at the RS, if registered before the new OSCORE Security Context has been established. Alternatively, applications need to implement a mechanism to ensure that, from then on, messages exchanged within those observations are going to be protected with the newly derived OSCORE Security Context.<a href="#section-7-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">This document specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. Thus, the general security considerations from the ACE framework also apply to this profile.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Furthermore, the security considerations from OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> and from EDHOC <span>[<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span> also apply to this specific use of the OSCORE and EDHOC protocols.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">As previously stated, once completed the EDHOC execution, C and the RS are mutually authenticated through their respective authentication credentials, whose retrieval has been facilitated by the AS. Also once completed the EDHOC execution, C and the RS have established a long-term secret key PRK_OUT enjoying forward secrecy. This is in turn used by C and the RS to establish an OSCORE Security Context.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">Furthermore, the RS achieves confirmation that C has PRK_OUT (proof-of-possession) when completing the EDHOC execution. Rather, C achieves confirmation that the RS has PRK_OUT (proof-of-possession) either when receiving the optional EDHOC message_4 from the RS, or when successfully verifying a response from the RS protected with the established OSCORE Security Context.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">OSCORE is designed to secure point-to-point communication, providing a secure binding between a request and the corresponding response(s). Thus, the basic OSCORE protocol is not intended for use in point-to-multipoint communication (e.g., enforced via multicast or a publish-subscribe model). Implementers of this profile should make sure that their use case of OSCORE corresponds to the expected one, in order to prevent weakening the security assurances provided by OSCORE.<a href="#section-8-5" class="pilcrow">¶</a></p>
<p id="section-8-6">As defined in <a href="#edhoc-key-update" class="xref">Section 5</a>, C can (re-)post an access token to the RS and contextually exchange two nonces N1 and N2, in order to efficiently use the EDHOC-KeyUpdate function rather than re-running the EDHOC protocol with the RS. The use of nonces guarantees uniqueness of the new PRK_OUT derived by running EDHOC_KeyUpdate. Consequently, it ensures uniqueness of the AEAD (nonce, key) pairs later used by C and the RS, when protecting their communications with the OSCORE Security Context established after updating PRK_OUT. Thus, it is REQUIRED that the exchanged nonces are not reused with the same pair of authentication credentials (AUTH_CRED_C, AUTH_CRED_RS), even in case of reboot. When using this profile, it is RECOMMENDED to use a 64-bit long random numbers as a nonce's value. Considering the birthday paradox, the average collision for each nonce will happen after 2^32 messages, which amounts to considerably more issued access token than it would be expected for intended applications. If applications use something else, such as a counter, they need to guarantee that reboot and loss of state on either node does not yield reuse of nonces. If that is not guaranteed, nodes are susceptible to reuse of AEAD (nonce, key) pairs, especially since an on-path attacker can cause the use of a previously exchanged nonce N1 by replaying the corresponding C-to-RS message.<a href="#section-8-6" class="pilcrow">¶</a></p>
<p id="section-8-7">When using this profile, it is RECOMMENDED that the RS stores only one access token per client. The use of multiple access tokens for a single client increases the strain on the RS, since it must consider every access token associated with the client and calculate the actual permissions that that client has. Also, access tokens indicating different or disjoint permissions from each other may lead the RS to enforce wrong permissions.  If one of the access tokens expires earlier than others, the resulting permissions may offer insufficient protection. Developers SHOULD avoid using multiple access tokens for a same client. Furthermore, the RS MUST NOT store more than one access token per client per PoP-key (i.e., per client's authentication credential).<a href="#section-8-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="privacy-considerations">
<section id="section-9">
      <h2 id="name-privacy-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
      </h2>
<p id="section-9-1">This document specifies a profile for the Authentication and Authorization for Constrained Environments (ACE) framework <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>. Thus, the general privacy considerations from the ACE framework also apply to this profile.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">Furthermore, the privacy considerations from OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> and from EDHOC <span>[<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span> also apply to this specific use of the OSCORE and EDHOC protocols.<a href="#section-9-2" class="pilcrow">¶</a></p>
<p id="section-9-3">An unprotected response to an unauthorized request may disclose information about the RS and/or its existing relationship with C. It is advisable to include as little information as possible in an unencrypted response. When an OSCORE Security Context already exists between C and the RS, more detailed information may be included.<a href="#section-9-3" class="pilcrow">¶</a></p>
<p id="section-9-4">Except for the case where C attempts to update its access rights, the (encrypted) access token is sent in an unprotected POST request to the authz-info endpoint at the RS. Thus, if C uses the same single access token from multiple locations, it can risk being tracked by the access token's value even when the access token is encrypted.<a href="#section-9-4" class="pilcrow">¶</a></p>
<p id="section-9-5">As defined in <a href="#edhoc-key-update" class="xref">Section 5</a>, C can (re-)post an access token to the RS and contextually exchange two nonces N1 and N2, in order to efficiently use the EDHOC-KeyUpdate function rather than re-running the EDHOC protocol with the RS. Since the exchanged nonces are also sent in the clear, using random nonces is best for privacy, as opposed to, e.g., a counter that might leak some information about C.<a href="#section-9-5" class="pilcrow">¶</a></p>
<p id="section-9-6">The identifiers used in OSCORE, i.e., the OSCORE Sender/Recipient IDs, are negotiated by C and the RS during the EDHOC execution. That is, the EDHOC Connection Identifier C_I of C is going to be the OSCORE Recipient ID of C (the OSCORE Sender ID of the RS). Conversely, the EDHOC Connection Identifier C_R of the RS is going to be the OSCORE Recipient ID of the RS (the OSCORE Sender ID of C). These OSCORE identifiers are privacy sensitive (see <span><a href="https://rfc-editor.org/rfc/rfc8613#section-12.8" class="relref">Section 12.8</a> of [<a href="#RFC8613" class="xref">RFC8613</a>]</span>). In particular, they could reveal information about C, or may be used for correlating different requests from C, e.g., across different networks that C has joined and left over time. This can be mitigated if C and the RS dynamically update their OSCORE identifiers, e.g., by using the method defined in <span>[<a href="#I-D.ietf-core-oscore-key-update" class="xref">I-D.ietf-core-oscore-key-update</a>]</span>.<a href="#section-9-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">This document has the following actions for IANA.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">Note to RFC Editor: Please replace all occurrences of "[RFC-XXXX]" with
the RFC number of this specification and delete this paragraph.<a href="#section-10-2" class="pilcrow">¶</a></p>
<div id="iana-ace-oauth-profile">
<section id="section-10.1">
        <h3 id="name-ace-oauth-profile-registry">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-ace-oauth-profile-registry" class="section-name selfRef">ACE OAuth Profile Registry</a>
        </h3>
<p id="section-10.1-1">IANA is asked to add the following entry to the "ACE OAuth Profile"
Registry following the procedure specified in <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.1-2.1">Profile name: coap_edhoc_oscore<a href="#section-10.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.1-2.2">Profile Description: Profile for delegating client authentication and
authorization in a constrained environment by establishing an OSCORE Security Context <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> between resource-constrained nodes, through the execution of the authenticated key establishment protocol EDHOC <span>[<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>.<a href="#section-10.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.1-2.3">Profile ID:  TBD (value between 1 and 255)<a href="#section-10.1-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.1-2.4">Change Controller: IESG<a href="#section-10.1-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.1-2.5">Reference:  [RFC-XXXX]<a href="#section-10.1-2.5" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="iana-oauth-params">
<section id="section-10.2">
        <h3 id="name-oauth-parameters-registry">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-oauth-parameters-registry" class="section-name selfRef">OAuth Parameters Registry</a>
        </h3>
<p id="section-10.2-1">IANA is asked to add the following entries to the "OAuth Parameters" registry.<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.2-2.1">Name: "edhoc_info"<a href="#section-10.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.2-2.2">Parameter Usage Location: token request, token response<a href="#section-10.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.2-2.3">Change Controller: IESG<a href="#section-10.2-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.2-2.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.2-2.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.2-3"></p>
<ul class="normal">
<li class="normal" id="section-10.2-4.1">Name: "token_uploaded"<a href="#section-10.2-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.2-4.2">Parameter Usage Location: token response<a href="#section-10.2-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.2-4.3">Change Controller: IESG<a href="#section-10.2-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.2-4.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.2-4.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="iana-oauth-cbor-mappings">
<section id="section-10.3">
        <h3 id="name-oauth-parameters-cbor-mappi">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-oauth-parameters-cbor-mappi" class="section-name selfRef">OAuth Parameters CBOR Mappings Registry</a>
        </h3>
<p id="section-10.3-1">IANA is asked to add the following entries to the "OAuth Parameters CBOR Mappings" following the procedure specified in <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.<a href="#section-10.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.3-2.1">Name: "edhoc_info"<a href="#section-10.3-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.3-2.2">CBOR Key: TBD<a href="#section-10.3-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.3-2.3">Value Type: map<a href="#section-10.3-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.3-2.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.3-2.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.3-3"></p>
<ul class="normal">
<li class="normal" id="section-10.3-4.1">Name: "token_uploaded"<a href="#section-10.3-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.3-4.2">CBOR Key: TBD<a href="#section-10.3-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.3-4.3">Value Type: simple value "true" / simple type "false"<a href="#section-10.3-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.3-4.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.3-4.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="iana-token-json-claims">
<section id="section-10.4">
        <h3 id="name-json-web-token-claims-regis">
<a href="#section-10.4" class="section-number selfRef">10.4. </a><a href="#name-json-web-token-claims-regis" class="section-name selfRef">JSON Web Token Claims Registry</a>
        </h3>
<p id="section-10.4-1">IANA is asked to add the following entries to the "JSON Web Token Claims" registry following the procedure specified in <span>[<a href="#RFC7519" class="xref">RFC7519</a>]</span>.<a href="#section-10.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.4-2.1">Claim Name: "edhoc_info"<a href="#section-10.4-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.4-2.2">Claim Description: Information for EDHOC execution<a href="#section-10.4-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.4-2.3">Change Controller: IETF<a href="#section-10.4-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.4-2.4">Reference: [RFC-XXXX]<a href="#section-10.4-2.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="iana-token-cwt-claims">
<section id="section-10.5">
        <h3 id="name-cbor-web-token-claims-regis">
<a href="#section-10.5" class="section-number selfRef">10.5. </a><a href="#name-cbor-web-token-claims-regis" class="section-name selfRef">CBOR Web Token Claims Registry</a>
        </h3>
<p id="section-10.5-1">IANA is asked to add the following entries to the "CBOR Web Token Claims" registry following the procedure specified in <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span>.<a href="#section-10.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.5-2.1">Claim Name: "edhoc_info"<a href="#section-10.5-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.5-2.2">Claim Description: Information for EDHOC execution<a href="#section-10.5-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.5-2.3">JWT Claim Name: "edhoc_info"<a href="#section-10.5-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.5-2.4">Claim Key: TBD<a href="#section-10.5-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.5-2.5">Claim Value Type(s): map<a href="#section-10.5-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.5-2.6">Change Controller: IESG<a href="#section-10.5-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.5-2.7">Specification Document(s): [RFC-XXXX]<a href="#section-10.5-2.7" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="iana-jwt-confirmation-methods">
<section id="section-10.6">
        <h3 id="name-jwt-confirmation-methods-re">
<a href="#section-10.6" class="section-number selfRef">10.6. </a><a href="#name-jwt-confirmation-methods-re" class="section-name selfRef">JWT Confirmation Methods Registry</a>
        </h3>
<p id="section-10.6-1">IANA is asked to add the following entries to the "JWT Confirmation Methods" registry following the procedure specified in <span>[<a href="#RFC7800" class="xref">RFC7800</a>]</span>.<a href="#section-10.6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.6-2.1">Confirmation Method Value: "x5bag"<a href="#section-10.6-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-2.2">Confirmation Method Description: An unordered bag of X.509 certificates<a href="#section-10.6-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-2.3">Change Controller: IESG<a href="#section-10.6-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-2.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.6-2.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.6-3"></p>
<ul class="normal">
<li class="normal" id="section-10.6-4.1">Confirmation Method Value: "x5chain"<a href="#section-10.6-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-4.2">Confirmation Method Description: An ordered chain of X.509 certificates<a href="#section-10.6-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-4.3">Change Controller: IESG<a href="#section-10.6-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-4.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.6-4.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.6-5"></p>
<ul class="normal">
<li class="normal" id="section-10.6-6.1">Confirmation Method Value: "x5t"<a href="#section-10.6-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-6.2">Confirmation Method Description: Hash of an X.509 certificate<a href="#section-10.6-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-6.3">Change Controller: IESG<a href="#section-10.6-6.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-6.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.6-6.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.6-7"></p>
<ul class="normal">
<li class="normal" id="section-10.6-8.1">Confirmation Method Value: "x5u"<a href="#section-10.6-8.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-8.2">Confirmation Method Description: URI pointing to an X.509 certificate<a href="#section-10.6-8.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-8.3">Change Controller: IESG<a href="#section-10.6-8.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-8.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.6-8.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.6-9"></p>
<ul class="normal">
<li class="normal" id="section-10.6-10.1">Confirmation Method Value: "c5b"<a href="#section-10.6-10.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-10.2">Confirmation Method Description: An unordered bag of C509 certificates<a href="#section-10.6-10.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-10.3">Change Controller: IESG<a href="#section-10.6-10.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-10.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.6-10.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.6-11"></p>
<ul class="normal">
<li class="normal" id="section-10.6-12.1">Confirmation Method Value: "c5c"<a href="#section-10.6-12.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-12.2">Confirmation Method Description: An ordered chain of C509 certificates<a href="#section-10.6-12.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-12.3">Change Controller: IESG<a href="#section-10.6-12.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-12.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.6-12.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.6-13"></p>
<ul class="normal">
<li class="normal" id="section-10.6-14.1">Confirmation Method Value: "c5t"<a href="#section-10.6-14.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-14.2">Confirmation Method Description: Hash of an C509 certificate<a href="#section-10.6-14.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-14.3">Change Controller: IESG<a href="#section-10.6-14.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-14.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.6-14.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.6-15"></p>
<ul class="normal">
<li class="normal" id="section-10.6-16.1">Confirmation Method Value: "c5u"<a href="#section-10.6-16.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-16.2">Confirmation Method Description: URI pointing to a COSE_C509 containing an ordere chain of certificates<a href="#section-10.6-16.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-16.3">Change Controller: IESG<a href="#section-10.6-16.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-16.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.6-16.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.6-17"></p>
<ul class="normal">
<li class="normal" id="section-10.6-18.1">Confirmation Method Value: "kcwt"<a href="#section-10.6-18.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-18.2">Confirmation Method Description: A CBOR Web Token (CWT) containing a COSE_Key in a 'cnf' claim<a href="#section-10.6-18.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-18.3">Change Controller: IESG<a href="#section-10.6-18.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-18.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.6-18.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.6-19"></p>
<ul class="normal">
<li class="normal" id="section-10.6-20.1">Confirmation Method Value: "kccs"<a href="#section-10.6-20.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-20.2">Confirmation Method Description: A CWT Claims Set (CCS) containing a COSE_Key in a 'cnf' claim<a href="#section-10.6-20.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-20.3">Change Controller: IESG<a href="#section-10.6-20.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.6-20.4">Specification Document(s): [RFC-XXXX]<a href="#section-10.6-20.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.6-21"></p>
</section>
</div>
<div id="iana-cwt-confirmation-methods">
<section id="section-10.7">
        <h3 id="name-cwt-confirmation-methods-re">
<a href="#section-10.7" class="section-number selfRef">10.7. </a><a href="#name-cwt-confirmation-methods-re" class="section-name selfRef">CWT Confirmation Methods Registry</a>
        </h3>
<p id="section-10.7-1">IANA is asked to add the following entries to the "CWT Confirmation Methods" registry following the procedure specified in <span>[<a href="#RFC8747" class="xref">RFC8747</a>]</span>.<a href="#section-10.7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.7-2.1">Confirmation Method Name: x5bag<a href="#section-10.7-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-2.2">Confirmation Method Description: An unordered bag of X.509 certificates<a href="#section-10.7-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-2.3">JWT Confirmation Method Name: "x5bag"<a href="#section-10.7-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-2.4">Confirmation Key: TBD<a href="#section-10.7-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-2.5">Confirmation Value Type(s): COSE_X509<a href="#section-10.7-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-2.6">Change Controller: IESG<a href="#section-10.7-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-2.7">Specification Document(s): [RFC-XXXX]<a href="#section-10.7-2.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.7-3"></p>
<ul class="normal">
<li class="normal" id="section-10.7-4.1">Confirmation Method Name: x5chain<a href="#section-10.7-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-4.2">Confirmation Method Description: An ordered chain of X.509 certificates<a href="#section-10.7-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-4.3">JWT Confirmation Method Name: "x5chain"<a href="#section-10.7-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-4.4">Confirmation Key: TBD<a href="#section-10.7-4.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-4.5">Confirmation Value Type(s): COSE_X509<a href="#section-10.7-4.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-4.6">Change Controller: IESG<a href="#section-10.7-4.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-4.7">Specification Document(s): [RFC-XXXX]<a href="#section-10.7-4.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.7-5"></p>
<ul class="normal">
<li class="normal" id="section-10.7-6.1">Confirmation Method Name: x5t<a href="#section-10.7-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-6.2">Confirmation Method Description: Hash of an X.509 certificate<a href="#section-10.7-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-6.3">JWT Confirmation Method Name: "x5t"<a href="#section-10.7-6.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-6.4">Confirmation Key: TBD<a href="#section-10.7-6.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-6.5">Confirmation Value Type(s): COSE_CertHash<a href="#section-10.7-6.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-6.6">Change Controller: IESG<a href="#section-10.7-6.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-6.7">Specification Document(s): [RFC-XXXX]<a href="#section-10.7-6.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.7-7"></p>
<ul class="normal">
<li class="normal" id="section-10.7-8.1">Confirmation Method Name: x5u<a href="#section-10.7-8.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-8.2">Confirmation Method Description: URI pointing to an X.509 certificate<a href="#section-10.7-8.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-8.3">JWT Confirmation Method Name: "x5u"<a href="#section-10.7-8.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-8.4">Confirmation Key: TBD<a href="#section-10.7-8.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-8.5">Confirmation Value Type(s): uri<a href="#section-10.7-8.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-8.6">Change Controller: IESG<a href="#section-10.7-8.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-8.7">Specification Document(s): [RFC-XXXX]<a href="#section-10.7-8.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.7-9"></p>
<ul class="normal">
<li class="normal" id="section-10.7-10.1">Confirmation Method Name: c5b<a href="#section-10.7-10.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-10.2">Confirmation Method Description: An unordered bag of C509 certificates<a href="#section-10.7-10.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-10.3">JWT Confirmation Method Name: "c5b"<a href="#section-10.7-10.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-10.4">Confirmation Key: TBD<a href="#section-10.7-10.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-10.5">Confirmation Value Type(s): COSE_C509<a href="#section-10.7-10.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-10.6">Change Controller: IESG<a href="#section-10.7-10.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-10.7">Specification Document(s): [RFC-XXXX]<a href="#section-10.7-10.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.7-11"></p>
<ul class="normal">
<li class="normal" id="section-10.7-12.1">Confirmation Method Name: c5c<a href="#section-10.7-12.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-12.2">Confirmation Method Description: An ordered chain of C509 certificates<a href="#section-10.7-12.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-12.3">JWT Confirmation Method Name: "c5c"<a href="#section-10.7-12.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-12.4">Confirmation Key: TBD<a href="#section-10.7-12.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-12.5">Confirmation Value Type(s): COSE_C509<a href="#section-10.7-12.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-12.6">Change Controller: IESG<a href="#section-10.7-12.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-12.7">Specification Document(s): [RFC-XXXX]<a href="#section-10.7-12.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.7-13"></p>
<ul class="normal">
<li class="normal" id="section-10.7-14.1">Confirmation Method Name: c5t<a href="#section-10.7-14.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-14.2">Confirmation Method Description: Hash of an C509 certificate<a href="#section-10.7-14.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-14.3">JWT Confirmation Method Name: "c5t"<a href="#section-10.7-14.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-14.4">Confirmation Key: TBD<a href="#section-10.7-14.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-14.5">Confirmation Value Type(s): COSE_CertHash<a href="#section-10.7-14.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-14.6">Change Controller: IESG<a href="#section-10.7-14.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-14.7">Specification Document(s): [RFC-XXXX]<a href="#section-10.7-14.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.7-15"></p>
<ul class="normal">
<li class="normal" id="section-10.7-16.1">Confirmation Method Name: c5u<a href="#section-10.7-16.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-16.2">Confirmation Method Description: URI pointing to a COSE_C509 containing an ordere chain of certificates<a href="#section-10.7-16.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-16.3">JWT Confirmation Method Name: "c5u"<a href="#section-10.7-16.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-16.4">Confirmation Key: TBD<a href="#section-10.7-16.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-16.5">Confirmation Value Type(s): uri<a href="#section-10.7-16.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-16.6">Change Controller: IESG<a href="#section-10.7-16.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-16.7">Specification Document(s): [RFC-XXXX]<a href="#section-10.7-16.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.7-17"></p>
<ul class="normal">
<li class="normal" id="section-10.7-18.1">Confirmation Method Name: kcwt<a href="#section-10.7-18.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-18.2">Confirmation Method Description: A CBOR Web Token (CWT) containing a COSE_Key in a 'cnf' claim<a href="#section-10.7-18.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-18.3">JWT Confirmation Method Name: "kcwt"<a href="#section-10.7-18.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-18.4">Confirmation Key: TBD<a href="#section-10.7-18.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-18.5">Confirmation Value Type(s): COSE_Messages<a href="#section-10.7-18.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-18.6">Change Controller: IESG<a href="#section-10.7-18.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-18.7">Specification Document(s): [RFC-XXXX]<a href="#section-10.7-18.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.7-19"></p>
<ul class="normal">
<li class="normal" id="section-10.7-20.1">Confirmation Method Name: kccs<a href="#section-10.7-20.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-20.2">Confirmation Method Description: A CWT Claims Set (CCS) containing a COSE_Key in a 'cnf' claim<a href="#section-10.7-20.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-20.3">JWT Confirmation Method Name: "kccs"<a href="#section-10.7-20.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-20.4">Confirmation Key: TBD<a href="#section-10.7-20.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-20.5">Confirmation Value Type(s): map / #6(map)<a href="#section-10.7-20.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-20.6">Change Controller: IESG<a href="#section-10.7-20.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.7-20.7">Specification Document(s): [RFC-XXXX]<a href="#section-10.7-20.7" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="iana-edhoc-ead">
<section id="section-10.8">
        <h3 id="name-edhoc-external-authorizatio">
<a href="#section-10.8" class="section-number selfRef">10.8. </a><a href="#name-edhoc-external-authorizatio" class="section-name selfRef">EDHOC External Authorization Data Registry</a>
        </h3>
<p id="section-10.8-1">IANA is asked to add the following entry to the "EDHOC External Authorization Data" defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14#section-9.5" class="relref">Section 9.5</a> of [<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>.<a href="#section-10.8-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.8-2.1">Label: TBD<a href="#section-10.8-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.8-2.2">Message: EDHOC message_1<a href="#section-10.8-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.8-2.3">Description: "ead_value" specifies an access token<a href="#section-10.8-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.8-2.4">Reference: [RFC-XXXX]<a href="#section-10.8-2.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="iana-edhoc-parameters">
<section id="section-10.9">
        <h3 id="name-edhoc-information-registry">
<a href="#section-10.9" class="section-number selfRef">10.9. </a><a href="#name-edhoc-information-registry" class="section-name selfRef">EDHOC Information Registry</a>
        </h3>
<p id="section-10.9-1">It is requested that IANA create a new registry entitled "EDHOC Information" registry. The registry is to be created with registration policy Expert Review <span>[<a href="#RFC8126" class="xref">RFC8126</a>]</span>. Guidelines for the experts are provided in <a href="#iana-expert-review" class="xref">Section 10.10</a>. It should be noted that in addition to the expert review, some portions of the registry require a specification, potentially on Standards Track, be supplied as well.<a href="#section-10.9-1" class="pilcrow">¶</a></p>
<p id="section-10.9-2">The columns of the registry are:<a href="#section-10.9-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.9-3.1">
            <p id="section-10.9-3.1.1">Name: A descriptive name that enables easier reference to this item. Because a core goal of this document is for the resulting representations to be compact, it is RECOMMENDED that the name be short.<a href="#section-10.9-3.1.1" class="pilcrow">¶</a></p>
<p id="section-10.9-3.1.2">
This name is case sensitive. Names may not match other registered names in a case-insensitive manner unless the Designated Experts determine that there is a compelling reason to allow an exception. The name is not used in the CBOR encoding.<a href="#section-10.9-3.1.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-10.9-3.2">
            <p id="section-10.9-3.2.1">CBOR Value: The value to be used as CBOR abbreviation of the item.<a href="#section-10.9-3.2.1" class="pilcrow">¶</a></p>
<p id="section-10.9-3.2.2">
The value MUST be unique. The value can be a positive integer, a negative integer or a string. Integer values between -256 and 255 and strings of length 1 are to be registered by Standards Track documents (Standards Action). Integer values from -65536 to -257 and from 256 to 65535 and strings of maximum length 2 are to be registered by public specifications (Specification Required). Integer values greater than 65535 and strings of length greater than 2 are subject to the Expert Review policy. Integer values less than -65536 are marked as private use.<a href="#section-10.9-3.2.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-10.9-3.3">CBOR Type: The CBOR type of the item, or a pointer to the registry that defines its type, when that depends on another item.<a href="#section-10.9-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.9-3.4">Registry: The registry that values of the item may come from, if one exists.<a href="#section-10.9-3.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.9-3.5">Description: A brief description of this item.<a href="#section-10.9-3.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.9-3.6">Specification: A pointer to the public specification for the item, if one exists.<a href="#section-10.9-3.6" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.9-4">This registry will be initially populated by the values in <a href="#fig-cbor-key-edhoc-params" class="xref">Figure 6</a>. The "Specification" column for all of these entries will be this document and <span>[<a href="#I-D.ietf-lake-edhoc" class="xref">I-D.ietf-lake-edhoc</a>]</span>.<a href="#section-10.9-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-expert-review">
<section id="section-10.10">
        <h3 id="name-expert-review-instructions">
<a href="#section-10.10" class="section-number selfRef">10.10. </a><a href="#name-expert-review-instructions" class="section-name selfRef">Expert Review Instructions</a>
        </h3>
<p id="section-10.10-1">The IANA registry established in this document is defined to use the registration policy Expert Review. This section gives some general guidelines for what the experts should be looking for, but they are being designated as experts for a reason so they should be given substantial latitude.<a href="#section-10.10-1" class="pilcrow">¶</a></p>
<p id="section-10.10-2">Expert reviewers should take into consideration the following points:<a href="#section-10.10-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.10-3.1">Point squatting should be discouraged. Reviewers are encouraged to get sufficient information for registration requests to ensure that the usage is not going to duplicate one that is already registered and that the point is likely to be used in deployments. The zones tagged as private use are intended for testing purposes and closed environments; code points in other ranges should not be assigned for testing.<a href="#section-10.10-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.10-3.2">Specifications are required for the Standards Action range of point assignment. Specifications should exist for Specification Required ranges, but early assignment before a specification is available is considered to be permissible. Specifications are needed for the first-come, first-serve range if they are expected to be used outside of closed environments in an interoperable way. When specifications are not provided, the description provided needs to have sufficient information to identify what the point is being used for.<a href="#section-10.10-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.10-3.3">Experts should take into account the expected usage of fields when approving point assignment. The fact that there is a range for Standards Track documents does not mean that a Standards Track document cannot have points assigned outside of that range. The length of the encoded value should be weighed against how many code points of that length are left, the size of device it will be used on, and the number of code points left that encode to that size.<a href="#section-10.10-3.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments (ACE) using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-oauth-authz-46</span>, <time datetime="2021-11-08" class="refDate">8 November 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46">https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-oauth-params">[I-D.ietf-ace-oauth-params]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refTitle">"Additional OAuth Parameters for Authorization in Constrained Environments (ACE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-oauth-params-16</span>, <time datetime="2021-09-07" class="refDate">7 September 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-params-16">https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-params-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-oscore-profile">[I-D.ietf-ace-oscore-profile]</dt>
        <dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, and <span class="refAuthor">M. Gunnarsson</span>, <span class="refTitle">"OSCORE Profile of the Authentication and Authorization for Constrained Environments Framework"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-oscore-profile-19</span>, <time datetime="2021-05-06" class="refDate">6 May 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oscore-profile-19">https://datatracker.ietf.org/doc/html/draft-ietf-ace-oscore-profile-19</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-edhoc">[I-D.ietf-core-oscore-edhoc]</dt>
        <dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Hoeglund, R.</span>, <span class="refAuthor">Hristozov, S.</span>, and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"Profiling EDHOC for CoAP and OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-edhoc-03</span>, <time datetime="2022-03-07" class="refDate">7 March 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-edhoc-03">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-edhoc-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-cbor-encoded-cert">[I-D.ietf-cose-cbor-encoded-cert]</dt>
        <dd>
<span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Raza, S.</span>, <span class="refAuthor">Höglund, J.</span>, and <span class="refAuthor">M. Furuhed</span>, <span class="refTitle">"CBOR Encoded X.509 Certificates (C509 Certificates)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-cbor-encoded-cert-03</span>, <time datetime="2022-01-10" class="refDate">10 January 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-cose-cbor-encoded-cert-03">https://datatracker.ietf.org/doc/html/draft-ietf-cose-cbor-encoded-cert-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-x509">[I-D.ietf-cose-x509]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Header parameters for carrying and referencing X.509 certificates"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-x509-08</span>, <time datetime="2020-12-14" class="refDate">14 December 2020</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-cose-x509-08">https://datatracker.ietf.org/doc/html/draft-ietf-cose-x509-08</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lake-edhoc">[I-D.ietf-lake-edhoc]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J. P.</span>, and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Ephemeral Diffie-Hellman Over COSE (EDHOC)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lake-edhoc-14</span>, <time datetime="2022-05-18" class="refDate">18 May 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14">https://datatracker.ietf.org/doc/html/draft-ietf-lake-edhoc-14</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6749">[RFC6749]</dt>
        <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6749">https://www.rfc-editor.org/rfc/rfc6749</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7252">https://www.rfc-editor.org/rfc/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7519">[RFC7519]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">N. Sakimura</span>, <span class="refTitle">"JSON Web Token (JWT)"</span>, <span class="seriesInfo">RFC 7519</span>, <span class="seriesInfo">DOI 10.17487/RFC7519</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7519">https://www.rfc-editor.org/rfc/rfc7519</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7800">[RFC7800]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Proof-of-Possession Key Semantics for JSON Web Tokens (JWTs)"</span>, <span class="seriesInfo">RFC 7800</span>, <span class="seriesInfo">DOI 10.17487/RFC7800</span>, <time datetime="2016-04" class="refDate">April 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7800">https://www.rfc-editor.org/rfc/rfc7800</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time datetime="2017-06" class="refDate">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8126">https://www.rfc-editor.org/rfc/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8392">[RFC8392]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"CBOR Web Token (CWT)"</span>, <span class="seriesInfo">RFC 8392</span>, <span class="seriesInfo">DOI 10.17487/RFC8392</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8392">https://www.rfc-editor.org/rfc/rfc8392</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8610">https://www.rfc-editor.org/rfc/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8613">https://www.rfc-editor.org/rfc/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8742">[RFC8742]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR) Sequences"</span>, <span class="seriesInfo">RFC 8742</span>, <span class="seriesInfo">DOI 10.17487/RFC8742</span>, <time datetime="2020-02" class="refDate">February 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8742">https://www.rfc-editor.org/rfc/rfc8742</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8747">[RFC8747]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Proof-of-Possession Key Semantics for CBOR Web Tokens (CWTs)"</span>, <span class="seriesInfo">RFC 8747</span>, <span class="seriesInfo">DOI 10.17487/RFC8747</span>, <time datetime="2020-03" class="refDate">March 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8747">https://www.rfc-editor.org/rfc/rfc8747</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
      <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-core-oscore-key-update">[I-D.ietf-core-oscore-key-update]</dt>
        <dd>
<span class="refAuthor">Höglund, R.</span> and <span class="refAuthor">M. Tiloca</span>, <span class="refTitle">"Key Update for OSCORE (KUDOS)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-key-update-01</span>, <time datetime="2022-03-07" class="refDate">7 March 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-key-update-01">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-key-update-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4949">[RFC4949]</dt>
        <dd>
<span class="refAuthor">Shirey, R.</span>, <span class="refTitle">"Internet Security Glossary, Version 2"</span>, <span class="seriesInfo">FYI 36</span>, <span class="seriesInfo">RFC 4949</span>, <span class="seriesInfo">DOI 10.17487/RFC4949</span>, <time datetime="2007-08" class="refDate">August 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4949">https://www.rfc-editor.org/rfc/rfc4949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7231">[RFC7231]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span> and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content"</span>, <span class="seriesInfo">RFC 7231</span>, <span class="seriesInfo">DOI 10.17487/RFC7231</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7231">https://www.rfc-editor.org/rfc/rfc7231</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9147">[RFC9147]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Tschofenig, H.</span>, and <span class="refAuthor">N. Modadugu</span>, <span class="refTitle">"The Datagram Transport Layer Security (DTLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 9147</span>, <span class="seriesInfo">DOI 10.17487/RFC9147</span>, <time datetime="2022-04" class="refDate">April 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9147">https://www.rfc-editor.org/rfc/rfc9147</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="examples">
<section id="appendix-A">
      <h2 id="name-examples">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
      </h2>
<p id="appendix-A-1">This appendix provides examples where this profile of ACE is used. In particular:<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-2.1">
          <a href="#example-without-optimization" class="xref">Appendix A.1</a> does not make use of use of any optimization.<a href="#appendix-A-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-2.2">
          <a href="#example-with-optimization" class="xref">Appendix A.2</a> makes use of the optimizations defined in this specification, hence reducing the roundtrips of the interactions between the Client and the RS.<a href="#appendix-A-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-2.3">
          <a href="#example-without-optimization-as-posting" class="xref">Appendix A.3</a> does not make use of any optimization, but consider an alternative workflow where the AS uploads the access token to the RS.<a href="#appendix-A-2.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-A-3">All these examples build on the following assumptions, as relying on expected early procedures performed at the AS. These include the registration of RSs by the respective Resource Owners as well as the registrations of Clients authorized to request access token for those RSs.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-4.1">The AS knows the authentication credential AUTH_CRED_C of the Client C.<a href="#appendix-A-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-4.2">The Client knows the authentication credential AUTH_CRED_AS of the AS.<a href="#appendix-A-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-4.3">The AS knows the authentication credential AUTH_CRED_RS of RS.<a href="#appendix-A-4.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-4.4">
          <p id="appendix-A-4.4.1">The RS knows the authentication credential AUTH_CRED_AS of the AS.<a href="#appendix-A-4.4.1" class="pilcrow">¶</a></p>
<p id="appendix-A-4.4.2">
This is relevant in case the AS and RS actually require a secure association (e.g., for the RS to perform token introspection at the AS, or for the AS to upload an access token to the RS on behalf of the Client).<a href="#appendix-A-4.4.2" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-5">As a result of the assumptions above, it is possible to limit the transport of AUTH_CRED_C and AUTH_CRED_RS by value only to the following two cases, and only when the Client requests an access token for the RS in question for the first time when considering the pair (AUTH_CRED_C, AUTH_CRED_RS).<a href="#appendix-A-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-6.1">In the Token Response from the AS to the Client, where AUTH_CRED_RS is specified by the 'rs_cnf' parameter.<a href="#appendix-A-6.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-6.2">
          <p id="appendix-A-6.2.1">In the access token, where AUTH_CRED_C is specified by the 'cnf' claim.<a href="#appendix-A-6.2.1" class="pilcrow">¶</a></p>
<p id="appendix-A-6.2.2">
Note that, even under the circumstances mentioned above, AUTH_CRED_C might rather be indicated by reference. This is possible if the RS can effectively use such a reference from the access token to retrieve AUTH_CRED_C (e.g., from a trusted repository of authentication credentials reachable through a non-constrained link), and if the AS is in turn aware of that.<a href="#appendix-A-6.2.2" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-7">In any other case, it is otherwise possible to indicate both AUTH_CRED_C and AUTH_CRED_RS by reference, when performing the ACE access control workflow as well as later on when the Client and RS run EDHOC.<a href="#appendix-A-7" class="pilcrow">¶</a></p>
<div id="example-without-optimization">
<section id="appendix-A.1">
        <h3 id="name-workflow-without-optimizati">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-workflow-without-optimizati" class="section-name selfRef">Workflow without Optimizations</a>
        </h3>
<p id="appendix-A.1-1">The example below considers the simplest (though least efficient) interaction between the Client and RS. That is: first the Client uploads the access token to the RS; then the Client and RS run EDHOC; and, finally, the Client accesses the protected resource at the RS.<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1-2">
<pre>
    C                                 AS                             RS
    |                                  |                              |
    |  EDHOC message_1 to /edhoc       |                              |
M01 |---------------------------------&gt;|                              |
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_2                 |                              |
M02 |&lt;---------------------------------|                              |
    |  ID_CRED_R identifies            |                              |
    |     CRED_R = AUTH_CRED_AS        |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_3 to /edhoc       |                              |
M03 |---------------------------------&gt;|                              |
    |  ID_CRED_I identifies            |                              |
    |     CRED_I = AUTH_CRED_C         |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  Token request to /token         |                              |
    |  (OSCORE-protected message)      |                              |
M04 |---------------------------------&gt;|                              |
    |  'req_cnf' identifies            |                              |
    |     AUTH_CRED_C by reference     |                              |
    |                                  |                              |
    |                                  |                              |
    |  Token response                  |                              |
    |  (OSCORE-protected message)      |                              |
M05 |&lt;---------------------------------|                              |
    |  'rs_cnf' specifies              |                              |
    |     AUTH_CRED_RS by value        |                              |
    |                                  |                              |
    |  'ace_profile' =                 |                              |
    |             coap_edhoc_oscore    |                              |
    |                                  |                              |
    |  'edhoc_info' specifies:         |                              |
    |     {                            |                              |
    |       id     : h'01',            |                              |
    |       suite  : 2,                |                              |
    |       methods: 3                 |                              |
    |     }                            |                              |
    |                                  |                              |
    |  In the access token:            |                              |
    |     * the 'cnf' claim specifies  |                              |
    |       AUTH_CRED_C by value       |                              |
    |     * the 'edhoc_info' claim     |                              |
    |       specifies the same as      |                              |
    |       'edhoc_info' above         |                              |
    |                                  |                              |

 // Possibly after chain verification, the Client adds AUTH_CRED_RS
 // to the set of its trusted peer authentication credentials,
 // relying on the AS as trusted provider

    |                                  |                              |
    |  Token upload to /authz-info     |                              |
    |  (unprotected message)           |                              |
M06 |----------------------------------------------------------------&gt;|
    |                                  |                              |

 // Possibly after chain verification, the RS adds AUTH_CRED_C
 // to the set of its trusted peer authentication credentials,
 // relying on the AS as trusted provider

    |                                  |                              |
    |   2.01 (Created)                 |                              |
    |   (unprotected message)          |                              |
M07 |&lt;----------------------------------------------------------------|
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_1 to /edhoc       |                              |
    |  (no access control is enforced) |                              |
M08 |----------------------------------------------------------------&gt;|
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_2                 |                              |
M09 |&lt;----------------------------------------------------------------|
    |  ID_CRED_R identifies            |                              |
    |     CRED_R = AUTH_CRED_RS        |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_3 to /edhoc       |                              |
    |  (no access control is enforced) |                              |
M10 |----------------------------------------------------------------&gt;|
    |  ID_CRED_I identifies            |                              |
    |     CRED_I = AUTH_CRED_C         |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  Access to protected resource    |                              |
    |  (OSCORE-protected message)      |                              |
    |  (access control is enforced)    |                              |
M11 |----------------------------------------------------------------&gt;|
    |                                  |                              |
    |  Response                        |                              |
    |  (OSCORE-protected message)      |                              |
M12 |&lt;----------------------------------------------------------------|
    |                                  |                              |

 // Later on, the access token expires ...
 //  - The Client and RS delete their OSCORE Security Context and
 //    terminate the EDHOC session used to derive it (unless the same
 //    session is also used for other reasons).
 //  - The RS retains AUTH_CRED_C as still valid,
 //    and the AS knows about it.
 //  - The Client retains AUTH_CRED_RS as still valid,
 //    and the AS knows about it.

    |                                  |                              |
    |                                  |                              |

 // Time passes ...

    |                                  |                              |
    |                                  |                              |

 // The Client asks for a new access token; now all the
 // authentication credentials can be indicated by reference

 // The price to pay is on the AS, about remembering that at least
 // one access token has been issued for the pair (Client, RS)
 // and considering the pair (AUTH_CRED_C, AUTH_CRED_RS)

    |                                  |                              |
    |  Token request to /token         |                              |
    |  (OSCORE-protected message)      |                              |
M13 |---------------------------------&gt;|                              |
    |  'req_cnf' identifies            |                              |
    |     CRED_I = AUTH_CRED_C         |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  Token response                  |                              |
    |  (OSCORE-protected message)      |                              |
M14 |&lt;---------------------------------|                              |
    |  'rs_cnf' identifies             |                              |
    |     AUTH_CRED_RS by reference    |                              |
    |                                  |                              |
    |  'ace_profile' =                 |                              |
    |             coap_edhoc_oscore    |                              |
    |                                  |                              |
    |  'edhoc_info' specifies:         |                              |
    |     {                            |                              |
    |       id     : h'05',            |                              |
    |       suite  : 2,                |                              |
    |       methods: 3                 |                              |
    |     }                            |                              |
    |                                  |                              |
    |  In the access token:            |                              |
    |     * the 'cnf' claim specifies  |                              |
    |       AUTH_CRED_C by reference   |                              |
    |     * the 'edhoc_info' claim     |                              |
    |       specifies the same as      |                              |
    |       'edhoc_info' above         |                              |
    |                                  |                              |
    |                                  |                              |
    |  Token upload to /authz-info     |                              |
    |  (unprotected message)           |                              |
M15 |----------------------------------------------------------------&gt;|
    |                                  |                              |
    |                                  |                              |
    |  2.01 (Created)                  |                              |
    |  (unprotected message)           |                              |
M16 |&lt;----------------------------------------------------------------|
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_1 to /edhoc       |                              |
    |  (no access control is enforced) |                              |
M17 |----------------------------------------------------------------&gt;|
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_2                 |                              |
    |  (no access control is enforced) |                              |
M18 |&lt;----------------------------------------------------------------|
    |  ID_CRED_R specifies             |                              |
    |     CRED_R = AUTH_CRED_RS        |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_3 to /edhoc       |                              |
    |  (no access control is enforced) |                              |
M19 |----------------------------------------------------------------&gt;|
    |  ID_CRED_I identifies            |                              |
    |     CRED_I = AUTH_CRED_C         |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  Access to protected resource /r |                              |
    |  (OSCORE-protected message)      |                              |
    |  (access control is enforced)    |                              |
M20 |----------------------------------------------------------------&gt;|
    |                                  |                              |
    |                                  |                              |
    |  Response                        |                              |
    |  (OSCORE-protected message)      |                              |
M21 |&lt;----------------------------------------------------------------|
    |                                  |                              |
</pre><a href="#appendix-A.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="example-with-optimization">
<section id="appendix-A.2">
        <h3 id="name-workflow-with-optimizations">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-workflow-with-optimizations" class="section-name selfRef">Workflow with Optimizations</a>
        </h3>
<p id="appendix-A.2-1">The example below builds on the example in <a href="#example-without-optimization" class="xref">Appendix A.1</a>, while additionally relying on the two following optimizations.<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-2.1">The access token is not separately uploaded to the /authz-info endpoint at the RS, but rather included in the EAD_1 field of EDHOC message_1 sent by the Client to the RS.<a href="#appendix-A.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="appendix-A.2-2.2">The Client uses the EDHOC+OSCORE request defined in <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="xref">I-D.ietf-core-oscore-edhoc</a>]</span> is used, when running EDHOC both with the AS and with the RS.<a href="#appendix-A.2-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="appendix-A.2-3">These two optimizations used together result in the most efficient interaction between the Client and RS, as consisting of only two roundtrips to upload the access token, run EDHOC and access the protected resource at the RS.<a href="#appendix-A.2-3" class="pilcrow">¶</a></p>
<p id="appendix-A.2-4">Also, a further optimization is used upon uploading a second access token to the RS, following the expiration of the first one. That is, after posting the second access token, the Client and RS do not run EDHOC again, but rather EDHOC-KeyUpdate() and EDHOC-Exporter() building on the same EDHOC session established before.<a href="#appendix-A.2-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.2-5">
<pre>
    C                                 AS                             RS
    |                                  |                              |
    |  EDHOC message_1 to /edhoc       |                              |
M01 |---------------------------------&gt;|                              |
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_2                 |                              |
M02 |&lt;---------------------------------|                              |
    |  ID_CRED_R identifies            |                              |
    |     CRED_R = AUTH_CRED_AS        |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  EDHOC+OSCORE request to /token  |                              |
M03 |---------------------------------&gt;|                              |
    |  * EDHOC message_3               |                              |
    |      ID_CRED_I identifies        |                              |
    |         CRED_I = AUTH_CRED_C     |                              |
    |         by reference             |                              |
    |  --- --- ---                     |                              |
    |  * OSCORE-protected part         |                              |
    |      Token request               |                              |
    |         'req_cnf' identifies     |                              |
    |         AUTH_CRED_C by reference |                              |
    |                                  |                              |
    |                                  |                              |
    |  Token response                  |                              |
    |  (OSCORE-protected message)      |                              |
M04 |&lt;---------------------------------|                              |
    |  'rs_cnf' specifies              |                              |
    |     AUTH_CRED_RS by value        |                              |
    |                                  |                              |
    |  'ace_profile' =                 |                              |
    |             coap_edhoc_oscore    |                              |
    |                                  |                              |
    |  'edhoc_info' specifies:         |                              |
    |     {                            |                              |
    |       id     : h'01',            |                              |
    |       suite  : 2,                |                              |
    |       methods: 3                 |                              |
    |     }                            |                              |
    |                                  |                              |
    |  In the access token:            |                              |
    |     * the 'cnf' claim specifies  |                              |
    |       AUTH_CRED_C by value       |                              |
    |     * the 'edhoc_info' claim     |                              |
    |       specifies the same as      |                              |
    |       'edhoc_info' above         |                              |
    |                                  |                              |

 // Possibly after chain verification, the Client adds AUTH_CRED_RS
 // to the set of its trusted peer authentication credentials,
 // relying on the AS as trusted provider

    |                                  |                              |
    |  EDHOC message_1 to /edhoc       |                              |
    |  (no access control is enforced) |                              |
M05 |----------------------------------------------------------------&gt;|
    |  Access token specified in EAD_1 |                              |
    |                                  |                              |

 // Possibly after chain verification, the RS adds AUTH_CRED_C
 // to the set of its trusted peer authentication credentials,
 // relying on the AS as trusted provider

    |                                  |                              |
    |  EDHOC message_2                 |                              |
M06 |&lt;----------------------------------------------------------------|
    |  ID_CRED_R identifies            |                              |
    |     CRED_R = AUTH_CRED_RS        |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  EDHOC+OSCORE request to /r      |                              |
M07 |----------------------------------------------------------------&gt;|
    |  * EDHOC message_3               |                              |
    |      ID_CRED_I identifies        |                              |
    |         CRED_I = AUTH_CRED_C     |                              |
    |         by reference             |                              |
    |  --- --- ---                     |                              |
    |  * OSCORE-protected part         |                              |
    |      Application request to /r   |                              |
    |                                  |                              |

 // After the EDHOC processing is completed, access control
 // is enforced on the rebuilt OSCORE-protected request,
 // like if it had been sent stand-alone

    |                                  |                              |
    |  Response                        |                              |
    |  (OSCORE-protected message)      |                              |
M08 |&lt;----------------------------------------------------------------|
    |                                  |                              |

 // Later on, the access token expires ...
 //  - The Client and RS delete their OSCORE Security Context and
 //    terminate the EDHOC session used to derive it (unless the same
 //    session is also used for other reasons).
 //  - The RS retains AUTH_CRED_C as still valid,
 //    and the AS knows about it.
 //  - The Client retains AUTH_CRED_RS as still valid,
 //    and the AS knows about it.

    |                                  |                              |
    |                                  |                              |

 // Time passes ...

    |                                  |                              |
    |                                  |                              |

 // The Client asks for a new access token; now all the
 // authentication credentials can be indicated by reference

 // The price to pay is on the AS, about remembering that at least
 // one access token has been issued for the pair (Client, RS)
 // and considering the pair (AUTH_CRED_C, AUTH_CRED_RS)

    |                                  |                              |
    |  Token request to /token         |                              |
    |  (OSCORE-protected message)      |                              |
M09 |---------------------------------&gt;|                              |
    |  'req_cnf' identifies            |                              |
    |     CRED_I = AUTH_CRED_C         |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |  Token response                  |                              |
    |  (OSCORE-protected message)      |                              |
M10 |&lt;---------------------------------|                              |
    |  'rs_cnf' identifies             |                              |
    |     AUTH_CRED_RS by reference    |                              |
    |                                  |                              |
    |  'ace_profile' =                 |                              |
    |             coap_edhoc_oscore    |                              |
    |                                  |                              |
    |  'edhoc_info' specifies:         |                              |
    |     {                            |                              |
    |       id     : h'05',            |                              |
    |       suite  : 2,                |                              |
    |       methods: 3                 |                              |
    |     }                            |                              |
    |                                  |                              |
    |  In the access token:            |                              |
    |     * the 'cnf' claim specifies  |                              |
    |       AUTH_CRED_C by reference   |                              |
    |     * the 'edhoc_info' claim     |                              |
    |       specifies the same as      |                              |
    |       'edhoc_info' above         |                              |
    |                                  |                              |
    |                                  |                              |
    |  Token upload to /authz-info     |                              |
    |  (unprotected message)           |                              |
M11 |----------------------------------------------------------------&gt;|
    |   Payload {                      |                              |
    |     access_token: access token   |                              |
    |     nonce_1: N1  // nonce        |                              |
    |   }                              |                              |
    |                                  |                              |
    |                                  |                              |
    |  2.01 (Created)                  |                              |
    |  (unprotected message)           |                              |
M12 |&lt;----------------------------------------------------------------|
    |   Payload {                      |                              |
    |     nonce_2: N2  // nonce        |                              |
    |   }                              |                              |
    |                                  |                              |

 // The Client and RS first run EDHOC-KeyUpdate(N1 | N2), and
 // then EDHOC-Exporter() to derive a new OSCORE Master Secret and
 // OSCORE Master Salt, from which a new OSCORE Security Context is
 // derived. The Sender/Recipiend IDs are the same C_I and C_R from
 // the previous EDHOC execution

    |                                  |                              |
    |  Access to protected resource /r |                              |
    |  (OSCORE-protected message)      |                              |
    |  (access control is enforced)    |                              |
M13 |----------------------------------------------------------------&gt;|
    |                                  |                              |
    |                                  |                              |
    |  Response                        |                              |
    |  (OSCORE-protected message)      |                              |
M14 |&lt;----------------------------------------------------------------|
    |                                  |                              |
</pre><a href="#appendix-A.2-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="example-without-optimization-as-posting">
<section id="appendix-A.3">
        <h3 id="name-workflow-without-optimizatio">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-workflow-without-optimizatio" class="section-name selfRef">Workflow without Optimizations (AS token posting)</a>
        </h3>
<p id="appendix-A.3-1">The example below builds on the example in <a href="#example-without-optimization" class="xref">Appendix A.1</a>, but assumes that the AS is uploading the access token to the RS on behalf of C.<a href="#appendix-A.3-1" class="pilcrow">¶</a></p>
<p id="appendix-A.3-2">In order to save roundtrips between the Client and RS, further, more efficient interactions can be seamlessly considered, e.g., as per the example in <a href="#example-with-optimization" class="xref">Appendix A.2</a>.<a href="#appendix-A.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.3-3">
<pre>
    C                                 AS                             RS
    |                                  |                              |
    |                                  | Establish secure association |
    |                                  | (e.g., OSCORE using EDHOC)   |
    |                                  |&lt;----------------------------&gt;|
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_1 to /edhoc       |                              |
M01 |---------------------------------&gt;|                              |
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_2                 |                              |
M02 |&lt;---------------------------------|                              |
    |  ID_CRED_R identifies            |                              |
    |     CRED_R = AUTH_CRED_AS        |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_3 to /edhoc       |                              |
M03 |---------------------------------&gt;|                              |
    |  ID_CRED_I identifies            |                              |
    |     CRED_I = AUTH_CRED_C         |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  Token request to /token         |                              |
    |  (OSCORE-protected message)      |                              |
M04 |---------------------------------&gt;|                              |
    |  'req_cnf' identifies            |                              |
    |     AUTH_CRED_C by reference     |                              |
    |                                  |                              |
    |                                  |                              |
    |                                  |  Token upload to /authz-info |
    |                                  |  (OSCORE-protected message)  |
M05 |                                  |-----------------------------&gt;|
    |                                  |  In the access token:        |
    |                                  |     * the 'cnf' claim        |
    |                                  |       specifies AUTH_CRED_C  |
    |                                  |       by value               |
    |                                  |     * the 'edhoc_info'       |
    |                                  |       claim specifies        |
    |                                  |         {                    |
    |                                  |           id     : h'01',    |
    |                                  |           suite  : 2,        |
    |                                  |           methods: 3         |
    |                                  |         }                    |
    |                                  |                              |

 // Possibly after chain verification, the RS adds AUTH_CRED_C
 // to the set of its trusted peer authentication credentials,
 // relying on the AS as trusted provider

    |                                  |                              |
    |                                  |  2.01 (Created)              |
    |                                  |  (OSCORE-protected message)  |
M06 |                                  |&lt;-----------------------------|
    |                                  |                              |
    |                                  |                              |
    |  Token response                  |                              |
    |  (OSCORE-protected message)      |                              |
M07 |&lt;---------------------------------|                              |
    |  'rs_cnf' specifies              |                              |
    |     AUTH_CRED_RS by value        |                              |
    |                                  |                              |
    |  'ace_profile' =                 |                              |
    |             coap_edhoc_oscore    |                              |
    |                                  |                              |
    |  'token_uploaded' = true         |                              |
    |                                  |                              |
    |  'edhoc_info' specifies:         |                              |
    |     {                            |                              |
    |       id     : h'01',            |                              |
    |       suite  : 2,                |                              |
    |       methods: 3                 |                              |
    |     }                            |                              |
    |                                  |                              |


 // Possibly after chain verification, the Client adds AUTH_CRED_RS
 // to the set of its trusted peer authentication credentials,
 // relying on the AS as trusted provider

    |                                  |                              |
    |  EDHOC message_1 to /edhoc       |                              |
    |  (no access control is enforced) |                              |
M08 |----------------------------------------------------------------&gt;|
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_2                 |                              |
M09 |&lt;----------------------------------------------------------------|
    |  ID_CRED_R identifies            |                              |
    |     CRED_R = AUTH_CRED_RS        |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_3 to /edhoc       |                              |
    |  (no access control is enforced) |                              |
M10 |----------------------------------------------------------------&gt;|
    |  ID_CRED_I identifies            |                              |
    |     CRED_I = AUTH_CRED_C         |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  Access to protected resource    |                              |
    |  (OSCORE-protected message)      |                              |
    |  (access control is enforced)    |                              |
M11 |----------------------------------------------------------------&gt;|
    |                                  |                              |
    |                                  |                              |
    |  Response                        |                              |
    |  (OSCORE-protected message)      |                              |
M12 |&lt;----------------------------------------------------------------|
    |                                  |                              |

 // Later on, the access token expires ...
 //  - The Client and RS delete their OSCORE Security Context and
 //    terminate the EDHOC session used to derive it (unless the same
 //    session is also used for other reasons).
 //  - The RS retains AUTH_CRED_C as still valid,
 //    and the AS knows about it.
 //  - The Client retains AUTH_CRED_RS as still valid,
 //    and the AS knows about it.

    |                                  |                              |
    |                                  |                              |

 // Time passes ...

    |                                  |                              |
    |                                  |                              |

 // The Client asks for a new access token; now all the
 // authentication credentials can be indicated by reference

 // The price to pay is on the AS, about remembering that at least
 // one access token has been issued for the pair (Client, RS)
 // and considering the pair (AUTH_CRED_C, AUTH_CRED_RS)

    |                                  |                              |
    |  Token request to /token         |                              |
    |  (OSCORE-protected message)      |                              |
M13 |---------------------------------&gt;|                              |
    |  'req_cnf' identifies            |                              |
    |     CRED_I = AUTH_CRED_C         |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |                                  |  Token upload to /authz-info |
    |                                  |  (OSCORE-protected message)  |
M14 |                                  |-----------------------------&gt;|
    |                                  |  In the access token:        |
    |                                  |     * the 'cnf' claim        |
    |                                  |       specifies AUTH_CRED_C  |
    |                                  |       by reference           |
    |                                  |     * the 'edhoc_info'       |
    |                                  |       claim specifies        |
    |                                  |         {                    |
    |                                  |           id     : h'05',    |
    |                                  |           suite  : 2,        |
    |                                  |           methods: 3         |
    |                                  |         }                    |
    |                                  |                              |
    |                                  |                              |
    |                                  |  2.01 (Created)              |
    |                                  |  (OSCORE-protected message)  |
M15 |                                  |&lt;-----------------------------|
    |                                  |                              |
    |                                  |                              |
    |  Token response                  |                              |
    |  (OSCORE-protected message)      |                              |
M16 |&lt;---------------------------------|                              |
    |  'rs_cnf' specifies              |                              |
    |     AUTH_CRED_RS by reference    |                              |
    |                                  |                              |
    |  'ace_profile' =                 |                              |
    |             coap_edhoc_oscore    |                              |
    |                                  |                              |
    |  'token_uploaded' = true         |                              |
    |                                  |                              |
    |  'edhoc_info' specifies:         |                              |
    |     {                            |                              |
    |       id     : h'05',            |                              |
    |       suite  : 2,                |                              |
    |       methods: 3                 |                              |
    |     }                            |                              |
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_1 to /edhoc       |                              |
    |  (no access control is enforced) |                              |
M17 |----------------------------------------------------------------&gt;|
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_2                 |                              |
    |  (no access control is enforced) |                              |
M18 |&lt;----------------------------------------------------------------|
    |  ID_CRED_R specifies             |                              |
    |     CRED_R = AUTH_CRED_RS        |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  EDHOC message_3 to /edhoc       |                              |
    |  (no access control is enforced) |                              |
M19 |----------------------------------------------------------------&gt;|
    |  ID_CRED_I identifies            |                              |
    |     CRED_I = AUTH_CRED_C         |                              |
    |     by reference                 |                              |
    |                                  |                              |
    |                                  |                              |
    |  Access to protected resource /r |                              |
    |  (OSCORE-protected message)      |                              |
    |  (access control is enforced)    |                              |
M20 |----------------------------------------------------------------&gt;|
    |                                  |                              |
    |                                  |                              |
    |  Response                        |                              |
    |  (OSCORE-protected message)      |                              |
M21 |&lt;----------------------------------------------------------------|
    |                                  |                              |
</pre><a href="#appendix-A.3-3" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="acknowldegment">
<section id="appendix-B">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-B-1">Work on this document has in part been supported by the H2020 project SIFIS-Home (grant agreement 952652).<a href="#appendix-B-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Göran Selander</span></div>
<div dir="auto" class="left"><span class="org">Ericsson</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:goran.selander@ericsson.com" class="email">goran.selander@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">John Preuß Mattsson</span></div>
<div dir="auto" class="left"><span class="org">Ericsson</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:john.mattsson@ericsson.com" class="email">john.mattsson@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Marco Tiloca</span></div>
<div dir="auto" class="left"><span class="org">RISE</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:marco.tiloca@ri.se" class="email">marco.tiloca@ri.se</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Rikard Höglund</span></div>
<div dir="auto" class="left"><span class="org">RISE</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rikard.hoglund@ri.se" class="email">rikard.hoglund@ri.se</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
